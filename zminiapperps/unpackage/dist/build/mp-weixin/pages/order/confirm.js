"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-icons")+e.resolveComponent("v-order-sub-item2")+e.resolveComponent("v-order-info-item")+e.resolveComponent("uni-easyinput")+e.resolveComponent("v-order-confirm-bar2")+e.resolveComponent("v-pay-type-select")+e.resolveComponent("v-coupon-select")+e.resolveComponent("v-station-select")+e.resolveComponent("v-address-select"))()}Math||((()=>"../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js")+(()=>"../../components/v-order-sub-item2/v-order-sub-item2.js")+(()=>"../../components/v-order-info-item/v-order-info-item.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js")+(()=>"../../components/v-order-confirm-bar2/v-order-confirm-bar2.js")+(()=>"../../components/v-pay-type-select/v-pay-type-select.js")+(()=>"../../components/v-coupon-select/v-coupon-select.js")+(()=>"../../components/v-station-select/v-station-select.js")+(()=>"../../components/v-address-select/v-address-select.js"))();const t={__name:"confirm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(t){const n=e.ref(e.index.$enum);e.ref("去使用");const a=e.ref();let o=!1;const i=e.ref({}),u=e.ref("");let r=e.ref([]),l={},s=-1,d=e.useModel(t,"modelValue");const c=e.ref(),v=e.ref([]),p=e.ref({}),f=e.ref(),g=e.ref([]);let m=e.ref({});const _=e.ref(),y=e.ref([]);let x=e.ref({}),$=e.ref({}),h=e.ref("");const b=e.ref();let k="";e.onLoad((t=>{e.index.$http.post("v1/getInitDataConfirm",l).then((e=>{r.value=e.data.takeTypes})),t.sn?(k=t.sn,e.index.$tool.setNavTitle("订单查看"),e.index.$login.judgeLogin((()=>{e.index.$tool.showLoading(),e.index.$http.post("v1/getOrderDetail/"+k).then((t=>{e.index.$tool.hideLoading(),i.value=t.data.order,d.value=i.value.remark,h.value=i.value.pay_type||"",x.value=t.data.station,m.value=t.data.address,p.value=t.data.coupon,$.value=t.data.payTypes}))}))):function(t){if(a.value=t.from||"",l={from:t.from||"",goods_sn:t.goods_sn||"",goods_number:t.goods_number||"",address_gid:t.agid||"",station_gid:t.sgid||"",take_type:-1,pay_type:"",gift_card_sns:[]},"goods"==l.from){if(!l.goods_sn||!l.goods_number)return e.index.$tool.tip("请输入商品编号和数量")}else if("cart"!=l.from)return e.index.$tool.tip("路径参数错误，购物车不存在");e.index.$login.judgeLogin((()=>{L()}))}(t)}));const T=()=>{const t="订单编号："+i.value.sn;e.index.setClipboardData({data:t,success(t){e.index.$tool.tip("订单编号已复制")}})};function L(){e.index.$tool.showLoading(),e.index.$http.post("v1/getOrderConfirmInfoV2",l).then((t=>{e.index.$tool.hideLoading(),o=!1,i.value=t.data.orderInfo,u.value=t.data.freeDeliverTxt,t.data.address&&(m.value=t.data.address,l.address_gid=m.value.gid),t.data.station&&(x.value=t.data.station,l.station_gid=x.value.gid),v.value=t.data.couponList,t.data.coupon?(p.value=t.data.coupon,l.coupon_gid=p.value.gid):p.value={},$.value=t.data.payTypes})).catch((t=>{e.index.$tool.alert(t.info,(()=>{"cart"==l.from?e.index.$tool.navto("/pages/cart/cart"):e.index.$tool.back()}))}))}function j({detail:e}){s=e.value,l.take_type=s,s==n.value.order.TAKE_TYPE_SELF?l.address_gid="":s==n.value.order.TAKE_TYPE_DELIVER&&(l.station_gid=""),C()}function C(){e.index.$login.judgeLogin((()=>{L()}))}function E(){0==g.value.length?w((()=>f.value.open())):f.value.open()}async function w(t){const n=await e.index.$http.get("v1/getAddressList");if(1!=n.code)return e.index.$tool.tip(n.info||"系统错误");g.value=n.data.list,t&&t()}function I(e){m.value=e,l.address_gid=e.gid,f.value.close()}function V(){0==y.value.length?async function(t){let n={lat:39.136465,lng:117.209932};const a=await e.index.$http.get("v1/getStationListWithDistance",n);if(1!=a.code)return e.index.$tool.tip(a.info||"系统错误");y.value=a.data.list,t&&t()}((()=>_.value.open())):_.value.open()}function R(e){x.value=e,l.station_gid=e.gid,_.value.close()}function S(){0==v.value.length?async function(e){e&&e()}((()=>c.value.open())):c.value.open()}function D(e){c.value.close(),l.coupon_gid=e.gid,C()}function A(){p.value={},c.value.close(),l.coupon_gid="",C()}async function P(){b.value.open()}function O(t){if("giftcard"==t.payType){if(t.cardHasMoney<i.value.pay_amount)return e.index.$tool.tip("所选实物卡余额不足");l.gift_card_sns=t.selectedSn}else l.gift_card_sns=[];h.value=t.payType,b.value.close(),l.pay_type=h.value}const K=e.index.$tool.debounce((()=>{Y(i.value.sn,h.value)})),M=e.index.$tool.debounce((()=>0==i.value.subs.length||0==i.value.goods_total?e.index.$tool.tip("订单中没有商品"):-1==s?e.index.$tool.tip("请选择收货方式"):s!=n.value.order.TAKE_TYPE_SELF||l.station_gid?s!=n.value.order.TAKE_TYPE_DELIVER||l.address_gid?""==h.value?e.index.$tool.tip("请选择有效的支付方式"):"giftcard"==h.value&&0==l.gift_card_sns.length?e.index.$tool.tip("请选择有效的实物卡",!0,null,2):o?e.index.$tool.tip("订单已创建，请到我的订单列表继续支付"):(l.remark=d.value,void e.index.$http.post("v1/createOrderFromConfirmV2",l).then((t=>{if(!t.data.sn)return e.index.$tool.tip("订单创建失败");o=!0,Y(t.data.sn,h.value,!0)}))):e.index.$tool.tip("请选择收货地址"):e.index.$tool.tip("请选择自提水站")));async function Y(t,n,a=!1){if(i.value.pay_amount<0)return e.index.$tool.tip("支付金额不能小于0");switch(0==i.value.pay_amount&&(n="yue"),n){case"yue":e.index.$http.post(`v1/payOrder/${t}`,{pay_type:n}).then((n=>{e.index.$tool.navto("/pages/pay/success?type=order&sn="+t)}));break;case"giftcard":let o=l.gift_card_sns;e.index.$http.post(`v1/payOrder/${t}`,{pay_type:n,gift_card_sns:o}).then((n=>{e.index.$tool.navto("/pages/pay/success?type=order&sn="+t)}));break;case"weixin":const i=await e.index.$api.getPayInfo("order",t);if(1!=i.code)return e.index.$tool.tip(i.info||"系统错误");e.index.$tool.payment(i.data.payInfo,(()=>{e.index.$tool.navto("/pages/pay/success?type=order&sn="+t)}),(()=>{a&&e.index.$tool.tip("订单已创建",!0,(()=>{e.index.$tool.redirect("/pages/order/list")}))}));break;default:return e.index.$tool.tip("请选择有效的支付方式")}}function F(){e.index.$tool.back()}return(t,n)=>e.e({a:a.value},a.value?e.e({b:e.o(j),c:e.o((t=>e.isRef(s)?s.value=t:s=t)),d:e.p({localdata:e.unref(r),modelValue:e.unref(s)}),e:0==e.unref(s)},0==e.unref(s)?e.e({f:e.unref(x)&&e.unref(x).gid},e.unref(x)&&e.unref(x).gid?{g:e.t(e.unref(x).title),h:e.t("\n"),i:e.t(e.unref(x).province?e.unref(x).province+", ":""),j:e.t(e.unref(x).city?t.item.city+", ":""),k:e.t(e.unref(x).district?e.unref(x).district+", ":""),l:e.t(e.unref(x).street?e.unref(x).street+", ":""),m:e.t(e.unref(x).detail),n:e.t("\n"),o:e.t(e.unref(x).link_name),p:e.t(e.unref(x).link_phone)}:{},{q:e.p({type:"right",color:"#999999"}),r:e.o(V)}):1==e.unref(s)?e.e({t:e.unref(m)&&e.unref(m).gid},e.unref(m)&&e.unref(m).gid?{v:e.t(e.unref(m).province?e.unref(m).province+", ":""),w:e.t(e.unref(m).city?e.unref(m).city+", ":""),x:e.t(e.unref(m).district?e.unref(m).district+", ":""),y:e.t(e.unref(m).street?e.unref(m).street+", ":""),z:e.t(e.unref(m).detail),A:e.t("\n"),B:e.t(e.unref(m).link_name),C:e.t(e.unref(m).link_phone)}:{},{D:e.p({type:"right",color:"#999999"}),E:e.o(E)}):{},{s:1==e.unref(s)}):i.value.sn?e.e({G:e.t(i.value.take_type_txt),H:e.unref(x)&&e.unref(x).gid},e.unref(x)&&e.unref(x).gid?{I:e.t(e.unref(x).title),J:e.t("\n"),K:e.t(e.unref(x).province?e.unref(x).province+", ":""),L:e.t(e.unref(x).city?t.item.city+", ":""),M:e.t(e.unref(x).district?e.unref(x).district+", ":""),N:e.t(e.unref(x).street?e.unref(x).street+", ":""),O:e.t(e.unref(x).detail),P:e.t("\n"),Q:e.t(e.unref(x).link_name),R:e.t(e.unref(x).link_phone)}:e.unref(m)&&e.unref(m).gid?{T:e.t(e.unref(m).province?e.unref(m).province+", ":""),U:e.t(e.unref(m).city?e.unref(m).city+", ":""),V:e.t(e.unref(m).district?e.unref(m).district+", ":""),W:e.t(e.unref(m).street?e.unref(m).street+", ":""),X:e.t(e.unref(m).detail),Y:e.t("\n"),Z:e.t(e.unref(m).link_name),aa:e.t(e.unref(m).link_phone)}:{},{S:e.unref(m)&&e.unref(m).gid}):{},{F:i.value.sn,ab:i.value.sn},i.value.sn?{ac:e.t(i.value.sn),ad:e.o(T)}:{},{ae:e.f(i.value.subs,((t,n,a)=>({a:t.gid,b:"5fc85a06-3-"+a,c:e.p({item:t})}))),af:e.p({title:"商品金额",value:"￥"+(i.value.goods_amount||"0.00")}),ag:e.p({title:"优惠金额",value:"-￥"+(i.value.discount_amount||"0.00"),color:"#da4754",bold:!0}),ah:e.p({title:"商品实付金额",value:"￥"+(i.value.real_amount||"0.00"),bold:!0}),ai:e.p({title:"服务费",title2:u.value,title2color:"#da4754",value:"￥"+(i.value.deliver_amount||"0.00")}),aj:0==i.value.status},0==i.value.status?{ak:e.o(P),al:e.p({title:"支付方式",value:e.unref($)[e.unref(h)],type:"pay_type",color:"#999"})}:{am:e.p({title:"支付方式",value:e.unref($)[e.unref(h)],type:"pay_type",color:"#999",showRightIcon:!1})},{an:a.value},a.value?{ao:e.o(S),ap:e.p({title:"优惠券",value:p.value.title||"选择优惠券",type:"coupon",color:"#999"})}:i.value.sn?{ar:e.p({title:"优惠券",value:p.value&&p.value.title||"未使用",color:"#999"})}:{},{aq:i.value.sn,as:a.value},a.value?{at:e.o((t=>e.isRef(d)?d.value=t:d=t)),av:e.p({type:"textarea",trim:!0,maxlength:"100",placeholder:"请输入您的备注",autoHeight:!0,modelValue:e.unref(d)})}:i.value.sn?{ax:e.t(e.unref(d))}:{},{aw:i.value.sn,ay:i.value.deliver_remark},i.value.deliver_remark?{az:e.t(i.value.deliver_remark)}:{},{aA:i.value.deliver_images},i.value.deliver_images?{aB:e.f(i.value.deliver_images,((t,n,a)=>({a:e.o((t=>function(t){e.index.previewImage({current:t,urls:i.value.deliver_images})}(n)),n),b:t,c:n})))}:{},{aC:a.value},a.value?{aD:e.o(e.unref(M)),aE:e.p({money:i.value.pay_amount||"",number:i.value.goods_total,action:"create"})}:i.value.sn&&0==i.value.status?{aG:e.o(e.unref(K)),aH:e.p({money:i.value.pay_amount||"",number:i.value.goods_total,action:"pay"})}:i.value.sn&&i.value.status>0?{aJ:e.o(F),aK:e.p({money:i.value.pay_amount||"",number:i.value.goods_total,action:"navto"})}:{},{aF:i.value.sn&&0==i.value.status,aI:i.value.sn&&i.value.status>0,aL:e.sr(b,"5fc85a06-16",{k:"payTypeSelect"}),aM:e.o(O),aN:e.p({list:e.unref($)}),aO:e.sr(c,"5fc85a06-17",{k:"couponSelectRef"}),aP:e.o(D),aQ:e.o(A),aR:e.p({list:v.value}),aS:e.sr(_,"5fc85a06-18",{k:"stationSelectRef"}),aT:e.o(R),aU:e.p({list:y.value}),aV:e.sr(f,"5fc85a06-19",{k:"addressSelectRef"}),aW:e.o(I),aX:e.o(w),aY:e.p({list:g.value})})}},n=e._export_sfc(t,[["__scopeId","data-v-5fc85a06"]]);wx.createPage(n);

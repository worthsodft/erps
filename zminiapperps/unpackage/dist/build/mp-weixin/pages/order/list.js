"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("uni-segmented-control")+e.resolveComponent("v-order-item2")+e.resolveComponent("uni-load-more")+e.resolveComponent("uni-popup-dialog")+e.resolveComponent("uni-popup")+e.resolveComponent("v-button-w80")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("uni-easyinput"))()}Math||((()=>"../../uni_modules/uni-segmented-control/components/uni-segmented-control/uni-segmented-control.js")+(()=>"../../components/v-order-item2/v-order-item2.js")+(()=>"../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup-dialog/uni-popup-dialog.js")+(()=>"../../uni_modules/uni-popup/components/uni-popup/uni-popup.js")+(()=>"../../components/v-button-w80/v-button-w80.js")+(()=>"../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js"))();const o={__name:"list",setup(o){const t=e.ref({width:"400rpx"}),a=e.ref(),l={0:0,1:1,2:2,9:3},u=e.ref([{loadStatus:"more",page:1,total:0,list:[]},{loadStatus:"more",page:1,total:0,list:[]},{loadStatus:"more",page:1,total:0,list:[]},{loadStatus:"more",page:1,total:0,list:[]}]),n=e.ref(!0),i=e.ref(0),v=e.ref(!1),p=e.ref(),s=e.ref({}),d=e.ref(),r=e.ref(""),c=e.ref(),m=e.ref([]),f=e.ref({buyer_type:1,invoice_type:1});let b=e.index.$tool.cache("invoiceFormData");function x(e){let o=m.value.indexOf(e);-1==o?m.value.push(e):m.value.splice(o,1)}function y(e){s.value=e,f.value.sns=m.value,c.value.open()}function g(e){s.value=e,p.value.open()}function _(e){s.value=e,d.value.open()}function h({currentIndex:e}){f.value.buyer_type=e,0==e&&(f.value.invoice_type=0)}function $(){(function(){let o=f.value;return 0==m.value.length?e.index.$tool.tip("请选择要开票的订单"):[0,1].includes(o.buyer_type)?[0,1].includes(o.invoice_type)?o.buyer_type==e.index.$enum.invoice.BUYER_TYPE_P&&o.invoice_type==e.index.$enum.invoice.INVOICE_TYPE_S?e.index.$tool.tip("个人不能开具专用发票"):o.title?o.buyer_type!=e.index.$enum.invoice.BUYER_TYPE_E||o.taxno?o.email?!!e.index.$tool.isEmail(o.email)||e.index.$tool.tip("请输入正确的邮箱地址"):e.index.$tool.tip("请输入收票邮箱"):e.index.$tool.tip("请输入公司税号"):e.index.$tool.tip("请输入开票名称"):e.index.$tool.tip("请选择开票类型"):e.index.$tool.tip("请选择购买方类型")})()&&(f.value,e.index.$tool.cache("invoiceFormData",f.value),e.index.$tool.confirm("确认所填写信息全部正确，并提交开票申请吗？",(()=>{e.index.$http.post("v1/invoiceApply",f.value).then((o=>{e.index.$tool.tip(o.info||"操作成功"),c.value.close(),m.value=[],V()}))})))}function k(o){if(!o)return e.index.$tool.tip("请输入退款原因");!function(o){e.index.$http.post("v1/refundApply/"+s.value.sn,{reason:o}).then((o=>{1==o.code?e.index.$tool.success(o.info,!0,(()=>{C()})):e.index.$tool.tip(o.info||"申请退款失败")}))}(o)}function S(){V()}function j(){V()}function C(){p.value.close(),V(),setTimeout((()=>{i.value=3,V()}),1e3)}function P(o){let t=u.value[i.value];if("more"!=t.loadStatus)return;t.loadStatus="loading";let a=e.index.$tool.invert(l)[i.value]||0,n={page:t.page};e.index.$http.get("v1/getOrderPageDataByStatus/"+a,n).then((a=>{if(1!=a.code)return e.index.$tool.tip(a.info||"系统错误");let l=a.data.pageData;return 0==l.total?(t.loadStatus="nomore",t.list=[],void(u.value[i.value]=t)):0==l.data.length?(t.loadStatus="nomore",void(u.value[i.value]=t)):(t.list="reset"==o?[...l.data]:[...t.list,...l.data],0==t.total&&(t.total=l.total),t.list.length>=t.total?t.loadStatus="nomore":(t.loadStatus="more",t.page++),u.value[i.value]=t,void(v.value=!1))}))}function V(){v.value||(v.value=!0,setTimeout((()=>v.value=!1),500),function(){let e=u.value[i.value];e.loadStatus="more",e.page=1,e.total=0,u.value[i.value]=e}(),P("reset"))}function E(){v.value=!1}function T({currentIndex:e}){i.value=e}function I({detail:e}){m.value=[],i.value!=e.current&&(i.value=e.current),0==u.value[i.value].total&&P()}function D(){P()}return b&&(f.value=b),e.onLoad((o=>{i.value=l[+o.status||0],e.index.$http.get("v1/getOrderTabsData").then((e=>{a.value=e.data.tabsData,r.value=e.data.finishQrcodeTip})),P()})),(o,l)=>({a:e.o(T),b:e.p({current:i.value,values:a.value,"style-type":"text","active-color":"#5aa1d8"}),c:e.f(u.value,((o,t,a)=>e.e(2==i.value&&m.value.length>0?{a:e.o(y,t)}:{},{b:e.f(o.list,((o,t,l)=>({a:e.o((e=>n.value=!1),o.id),b:e.o((e=>n.value=!0),o.id),c:e.o(S,o.id),d:e.o(j,o.id),e:e.o(C,o.id),f:e.o(_,o.id),g:e.o(g,o.id),h:e.o(x,o.id),i:"03b3f0ce-1-"+a+"-"+l,j:e.p({item:o,isInvoice:m.value.includes(o.sn)}),k:o.id}))),c:e.o(P,t),d:"03b3f0ce-2-"+a,e:e.p({status:o.loadStatus}),f:e.o(D,t),g:e.o(V,t),h:e.o(E,t),i:e.o(E,t),j:t}))),d:2==i.value&&m.value.length>0,e:n.value,f:v.value,g:i.value,h:e.o(I),i:e.o((e=>p.value.close())),j:e.o(k),k:e.p({mode:"input",maxlength:50,beforeClose:!0,title:"退款原因",placeholder:"请输入退款原因"}),l:e.sr(p,"03b3f0ce-3",{k:"refundReasonPopup"}),m:e.p({type:"dialog"}),n:s.value.qrcode,o:e.t(s.value.sn),p:e.t(r.value),q:e.o((e=>d.value.close())),r:e.p({title:"关 闭"}),s:e.sr(d,"03b3f0ce-5",{k:"finishQrcodePopup"}),t:e.p({"background-color":"#fff"}),v:e.o(h),w:e.p({activeColor:"#6abfff",current:f.value.buyer_type??0,values:["自然人","公司"],styleType:"button"}),x:e.t(m.value.length),y:e.o((e=>f.value.invoice_type=e)),z:e.p({localdata:[{text:"普通发票",value:0},{text:"专用发票",value:1,disable:0==f.value.buyer_type}],modelValue:f.value.invoice_type}),A:e.s(t.value),B:e.o((e=>f.value.title=e)),C:e.p({clearable:!1,modelValue:f.value.title}),D:1==f.value.buyer_type?1:"",E:e.s(t.value),F:e.o((e=>f.value.taxno=e)),G:e.p({clearable:!1,modelValue:f.value.taxno}),H:e.s(t.value),I:e.o((e=>f.value.address=e)),J:e.p({clearable:!1,modelValue:f.value.address}),K:e.s(t.value),L:e.o((e=>f.value.phone=e)),M:e.p({clearable:!1,modelValue:f.value.phone}),N:e.s(t.value),O:e.o((e=>f.value.bank_name=e)),P:e.p({clearable:!1,modelValue:f.value.bank_name}),Q:e.s(t.value),R:e.o((e=>f.value.bank_account=e)),S:e.p({clearable:!1,modelValue:f.value.bank_account}),T:e.s(t.value),U:e.o((e=>f.value.email=e)),V:e.p({clearable:!1,modelValue:f.value.email}),W:e.o($),X:e.p({title:"确定提交"}),Y:e.sr(c,"03b3f0ce-7",{k:"applyInvoiceFormPopup"}),Z:e.p({"background-color":"#fff"})})}},t=e._export_sfc(o,[["__scopeId","data-v-03b3f0ce"]]);wx.createPage(t);

"use strict";const e=require("../../../common/vendor.js");if(!Array){(e.resolveComponent("uni-segmented-control")+e.resolveComponent("uni-section")+e.resolveComponent("uni-datetime-picker")+e.resolveComponent("uni-data-checkbox")+e.resolveComponent("v-order-item2-show")+e.resolveComponent("uni-load-more")+e.resolveComponent("v-goods-list"))()}Math||((()=>"../../../uni_modules/uni-segmented-control/components/uni-segmented-control/uni-segmented-control.js")+(()=>"../../../uni_modules/uni-section/components/uni-section/uni-section.js")+(()=>"../../../uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.js")+(()=>"../../../uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox.js")+(()=>"../../../components/v-order-item2-show/v-order-item2-show.js")+(()=>"../../../uni_modules/uni-load-more/components/uni-load-more/uni-load-more.js")+(()=>"../../../components/v-goods-list/v-goods-list.js"))();const o={__name:"order_deliver_list",setup(o){const t=e.ref(0),n=e.ref("支付时间"),s=e.ref([]),l=e.ref([]);let u=e.index.$tool.today();const a=e.ref([u,u]),i=e.ref("more"),r=e.ref([]);e.ref({});const d=e.ref(0);let v=1;const c=e.ref({}),m=e.ref(0),p=e.ref(),g=e.ref([]);function f(o){let t=[];if(r.value.forEach((e=>{e.checked&&t.push(e.sn)})),!o)return e.index.$tool.tip("请选择水站信息");e.index.$http.post("v1/orderPick",{sns:t,station_gid:o}).then((o=>{if(1!=o.code)return e.index.$tool.tip(o.info||"系统错误");e.index.$tool.tip(o.info||"操作成功"),$(),y("reset"),p.value.close()}))}function _(){if(!c.value||0==Object.keys(c.value).length)return e.index.$tool.tip("请选择配货商品");p.value.open()}function h(o){let t=r.value[o];if(t.checked=!t.checked,t.checked){for(let e in t.subs){let o=t.subs[e];c.value[o.goods_sn]?c.value[o.goods_sn].goods_number+=o.goods_number:c.value[o.goods_sn]={goods_sn:o.goods_sn,goods_cover:o.goods_cover,goods_name:o.goods_name,goods_number:o.goods_number,goods_unit:o.goods_unit},m.value+=o.goods_number}e.index.$tool.tip("配货商品已添加")}else{for(let e in t.subs){let o=t.subs[e],n=c.value[o.goods_sn].goods_number-o.goods_number;n<=0?delete c.value[o.goods_sn]:c.value[o.goods_sn].goods_number=n,m.value-=o.goods_number}e.index.$tool.tip("配货商品已去除")}r.value[o]=t}function b({currentIndex:e}){t.value=e,n.value=0==e?"支付时间":"配送时间",c.value={},m.value=0,$(),r.value=[],y("reset")}function x(e){0==e.length?a.value=[u,u]:a.value=e,$(),y("reset")}function k({detail:e}){$(),y("reset")}function $(){i.value="more",v=1}function y(o){if("more"!=i.value)return;i.value="loading";let n={page:v,takeAtRange:a.value,current:t.value,district:s.value};e.index.$http.post("v1/getMyDeliverOrderPageData",n).then((t=>{if(1!=t.code)return e.index.$tool.tip(t.info||"系统错误");let n=t.data.pageData;if(d.value=n.total,0==n.total)return i.value="nomore",r.value=[],void(m.value=0);0!=n.data.length?(r.value="reset"==o?[...n.data]:[...r.value,...n.data],r.value.length>=d.value?i.value="nomore":(i.value="more",v++)):i.value="nomore"}))}return e.index.$http.post("v1/getUserInfoDistricts").then((e=>{l.value=e.data.districts})),y(),e.index.$http.post("v1/getStationOpeningList").then((e=>{g.value=e.data.stationList})),e.onReachBottom((()=>{y()})),e.onPullDownRefresh((()=>{$(),y("reset"),setTimeout((()=>{e.index.stopPullDownRefresh()}),200)})),(o,u)=>e.e({a:e.o(b),b:e.p({activeColor:"#6abfff",current:t.value,values:["待配货","配送中","已配送"],styleType:"button"}),c:e.p({title:n.value+"：",type:"line"}),d:e.o(x),e:e.o((e=>a.value=e)),f:e.p({type:"daterange",rangeSeparator:"至",modelValue:a.value}),g:e.p({title:"配送区域：",type:"line"}),h:e.o(k),i:e.o((e=>s.value=e)),j:e.p({multiple:!0,localdata:l.value,modelValue:s.value}),k:e.p({title:"总订单数："+d.value,type:"line"}),l:0==t.value},0==t.value?{m:e.o(_),n:e.p({title:"配货商品总件数："+m.value+" 件",type:"line"})}:{},{o:e.f(r.value,((o,t,n)=>({a:e.o(h,o.id),b:"0d6f2334-7-"+n,c:e.p({item:o,index:t}),d:o.id}))),p:e.o(y),q:e.p({status:i.value}),r:e.sr(p,"0d6f2334-9",{k:"goodsListRef"}),s:e.o(f),t:e.p({list:c.value,stationList:g.value})})}},t=e._export_sfc(o,[["__scopeId","data-v-0d6f2334"]]);wx.createPage(t);

"use strict";const e=require("../../common/vendor.js");if(!Array){(e.resolveComponent("v-line-title")+e.resolveComponent("uni-easyinput"))()}Math||((()=>"../../components/v-line-title/v-line-title.js")+(()=>"../../uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput.js"))();const t={__name:"bind",setup(t){const a=e.ref({});e.ref();const n=e.ref([]),o=e.ref(),l=e.ref({sn:"",code:"",vcode:"",vuniqid:""}),i=e.ref([]);function u(){e.index.$http.post("v1/captcha",{type:"GiftCardBindCaptcha"}).then((e=>{a.value=e.data,l.value.vuniqid=e.data.uniqid}))}function d(){return l.value.sn?l.value.code?l.value.vcode?!!l.value.vuniqid||e.index.$tool.tip("请输入验证码标识"):e.index.$tool.tip("请输入验证码"):e.index.$tool.tip("请输入密码"):e.index.$tool.tip("请扫描或输入卡号")}function v(){d()&&c()}u(),e.index.$http.get("v1/getInitDataGiftCardBind").then((e=>{n.value=e.data.banners,i.value=e.data.remarks}));let c=e.index.$tool.debounce((()=>{l.value.type="GiftCardBindCaptcha",e.index.$http.post("v1/searchGiftCardForMiniBind",l.value).then((t=>{u(),l.value.vcode="",1==t.code&&(o.value=t.data.card,e.index.$tool.alert("卡有效，请核对信息无误后，点击“确认绑定”按钮，进行绑卡操作"))})).catch((e=>{u()}))}));function s(){d()&&p()}let p=e.index.$tool.debounce((()=>{l.value.type="GiftCardBindCaptcha",e.index.$http.post("v1/bindGiftCardForMiniBind",l.value).then((t=>{u(),1==t.code&&e.index.$tool.tip(t.info||"操作成功"),l.value.sn="",l.value.code="",l.value.vcode="",o.value=""})).catch((e=>{u()}))}));function r(){e.index.scanCode({success({result:e}){e?l.value.sn=e:console.log("扫码失败")},fail(e){console.log(e)}})}function f(){e.index.$tool.navto("/page_subs/gift_card/list")}function h(){e.index.$tool.navto("/page_subs/gift_card/logs")}return(t,d)=>e.e({a:o.value},o.value?e.e({b:e.t(o.value.sn),c:e.t(o.value.bind_expire_at),d:e.t(o.value.useful_days),e:0==o.value.use_type},0==o.value.use_type?{f:e.t(o.value.has)}:{g:e.t(o.value.take_goods_sn_txt),h:e.t(o.value.has)}):{i:e.f(n.value,((e,t,a)=>({a:e,b:t})))},{j:e.p({title:"卡号："}),k:e.o(r),l:e.o((e=>l.value.sn=e)),m:e.p({suffixIcon:"scan",placeholder:"请扫描或输入卡号",modelValue:l.value.sn}),n:e.p({title:"密码："}),o:e.o((e=>l.value.code=e)),p:e.p({placeholder:"请输入密码",modelValue:l.value.code}),q:e.p({title:"验证码："}),r:e.o((e=>l.value.vcode=e)),s:e.p({placeholder:"请输入验证码",modelValue:l.value.vcode}),t:a.value.image||"",v:e.o(u),w:o.value},o.value?{x:e.o(s)}:{y:e.o(v)},{z:e.o(h),A:e.o(f),B:i.value.length>0},i.value.length>0?{C:e.p({title:"使用说明"}),D:e.f(i.value,((t,a,n)=>({a:e.t(a+1),b:e.t(t),c:a})))}:{})}},a=e._export_sfc(t,[["__scopeId","data-v-75dca6cc"]]);wx.createPage(a);

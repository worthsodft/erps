"use strict";const e=require("../common/vendor.js"),t=require("./config.js"),n={back(t){e.index.navigateBack({delta:t||1})},navto(t,n){e.index.navigateTo({url:t||"/pages/index/index",fail(o){e.index.switchTab({url:t,fail(e){console.log(e),n&&n(e)}})}})},redirect(t){e.index.redirectTo({url:t||"/pages/index/index",fail(e){console.log(e)}})},relaunch(t){e.index.reLaunch({url:t||"/pages/index/index",fail(e){console.log(e)}})},index(){this.relaunch("/pages/index/index")},showLoading(t="加载中",n=!0){e.index.showLoading({title:t,mask:n})},hideLoading(){e.index.hideLoading()},tip(t,n=!1,o,a=1){a*=1e3,e.index.showToast({title:t||"提示内容",icon:"none",mask:n,duration:a,success(){a>0?setTimeout((()=>{o&&o()}),a):o&&o()}})},success(t,n=!1,o,a=1){a*=1e3,e.index.showToast({title:t||"提示内容",icon:"success",mask:n,duration:a,success(){a>0?setTimeout((()=>{o&&o()}),a):o&&o()}})},error(t,n=!1,o,a=1){a*=1e3,e.index.showToast({title:t||"提示内容",icon:"error",mask:n,duration:a,success(){a>0?setTimeout((()=>{o&&o()}),a):o&&o()}})},alert(t,n){e.index.showModal({title:"提示",content:t||"提示内容",showCancel:!1,success(){n&&n()}})},confirm(t,n,o,a={}){e.index.showModal({title:"确认",content:t||"确认内容",cancelText:a.cancelText||"取消",confirmText:a.confirmText||"确定",success(e){e.confirm?n&&n():o&&o()}})},cache(t,n=null){if(null===n){return e.index.getStorageSync(t)}return e.index.setStorageSync(t,n)},removeCache:t=>e.index.removeStorageSync(t),clearCache:t=>e.index.clearStorageSync(),setNavTitle(t){e.index.setNavigationBarTitle({title:t})},debounce(e,t=1e3,n=!0){let o;return function(){let a=this,r=arguments;if(o&&clearTimeout(o),n){let n=!o;o=setTimeout((()=>{o=null}),t),n&&e.apply(a,r)}else o=setTimeout((function(){e.apply(a,r)}),t)}},throttle(e,t=1e3){let n=Date.now();return function(){let o=Date.now(),a=this;o-n>=t&&(e.apply(a,arguments),n=Date.now())}},getCurrPage(){let e=getCurrentPages();return e.length<1?null:e[e.length-1]},getPrevPage(){let e=getCurrentPages(),t=e.length;return t<=1?null:e[t-2]},sec2str(e){let t=0,n=0;return e>59&&(t=parseInt(e/60),e=parseInt(e%60)),t>59&&(n=parseInt(t/60),t=parseInt(t%60)),e<10&&(e="0"+e),t<10&&(t="0"+t),n<10&&(n="0"+n),n+":"+t+":"+e},secondsToHms(e){const t=Math.floor(e/3600),n=Math.floor(e%3600/60),o=Math.floor(e%60);return(t>0?(t<10?"0"+t:t)+"时":"")+(n>0?(n<10?"0"+n:n)+"分":"")+(o>0?(o<10?"0"+o:o)+"秒":"")},isPhone:e=>/^1[3-9][0-9]{9}$/.test(e),isEmail:e=>/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e),isNumber(e){if("number"==typeof e)return!0;return/^[0-9]+.?[0-9]*/.test(e)},isAlphaNum(e){if(!e)return!1;return/^[A-Za-z0-9]+$/.test(e)},uuid(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)}))},format(e){let t=1;e<=9999999999&&(t=1e3);var n=new Date(e*t);return n.getFullYear()+"-"+((n.getMonth()+1<10?"0"+(n.getMonth()+1):n.getMonth()+1)+"-")+((n.getDate()<10?"0"+n.getDate():n.getDate())+" ")+((n.getHours()<10?"0"+n.getHours():n.getHours())+":")+((n.getMinutes()<10?"0"+n.getMinutes():n.getMinutes())+":")+(n.getSeconds()<10?"0"+n.getSeconds():n.getSeconds())},today(){var e=new Date;return e.getFullYear()+"-"+((e.getMonth()+1<10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-")+((e.getDate()<10?"0"+e.getDate():e.getDate())+" ")},getUrlParam(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");let t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))},getUrlParams(e){let t={},n=e.split("?")[1].split("&");for(let o=0,a=n.length;o<a;o++){let e=n[o].split("=");t[e[0]]=e[1]}return t},round2:e=>Math.round(100*e)/100,round3:e=>Math.round(1e3*e)/1e3,getTabBarHeight(){let t=this.cache("tabBarHeight");if(t)return t;const n=e.index.getSystemInfoSync();return t=n.screenHeight-n.safeArea.bottom,t},setCartBadge(t){0!=t?e.index.setTabBarBadge({index:2,text:t+"",fail(e){console.log(e)}}):e.index.hideTabBarRedDot({index:2,fail(e){console.log(e)}})},invert:e=>Object.keys(e).reduce(((t,n)=>(t[e[n]]=n,t)),{}),isRemoteUrl:e=>-1!==e.indexOf(t.config.domain),payment(t,n,o){e.index.requestPayment({...t,success(t){e.index.$tool.tip("已支付",!0,(()=>{n&&n()}))},fail(e){console.log(e),o&&o()}})},checkUpdateApp(t=!0){const n=this,o=e.index.getUpdateManager();!t&&n.showLoading("检查中"),o.onCheckForUpdate((function(a){!t&&n.hideLoading(),a.hasUpdate?(o.onUpdateReady((function(t){e.index.showModal({title:"更新提示",content:"新版本已经准备好，是否重启应用？",success(e){console.log(e),e.confirm&&o.applyUpdate()}})})),o.onUpdateFailed((function(e){console.log("新的版本下载失败")}))):!t&&n.tip("当前已是最新版")}))}};exports.tool=n;

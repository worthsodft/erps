"use strict";const e=require("../common/vendor.js"),t=require("./config.js"),o=require("./login.js"),r=new(require("./luch-request/core/Request.js").Request);r.setConfig((e=>(e.baseURL=t.config.domain,e))),r.interceptors.request.use((t=>(t.data=t.data||{},t.header.token=e.index.$tool.cache("token"),t)),(e=>Promise.reject(e))),r.interceptors.response.use((async t=>{const s=t.data;return 401==s.code?(console.log("token过期，重调"),await o.login.do(),t.config.header.token=e.index.$tool.cache("token"),r.request(t.config)):1==s.code?Promise.resolve(s):(e.index.$tool.tip(s.info||"系统错误",!1,null,3),Promise.reject(s))}),(e=>Promise.reject(e)));const s=(e,t={},o=!0,s="get")=>{let n={method:s=s.toUpperCase(),url:e};return"GET"==s?n.params=t:n.data=t,r.request(n)},n=(e,t={},o=!0)=>{let s={...t};return r.upload(e,s)},a={request:(e,t,o,r="get")=>s(e,t,o,r),get(e,t={},o=!0){return e="/api/"+e,this.request(e,t,o,"get")},post(e,t={},o=!0){return e="/api/"+e,this.request(e,t,o,"post")},upload:(e,t={},o=!0)=>n(e="/api/"+e,t,o),addon:{get:(e,t={},o=!0)=>s(e="/addon"+e,t,o,"get"),post:(e,t={},o=!0)=>s(e="/addon"+e,t,o,"post"),upload:(e,t={},o=!0)=>n(e="/addon"+e,t,o)}};exports.http=a;

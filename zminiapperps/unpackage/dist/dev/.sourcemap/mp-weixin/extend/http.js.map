{"version":3,"file":"http.js","sources":["extend/http.js"],"sourcesContent":["import config from \"@/extend/config.js\"\r\nimport login from \"@/extend/login.js\"\r\nimport Request from '@/extend/luch-request/index.js'\r\n\r\n// import base64 from \"@/extend/base64.js\"\n\nconst http = new Request();\r\n\r\nhttp.setConfig((config_) => {\r\n    config_.baseURL = config.domain;\n    return config_\n})\r\n\r\n// 请求拦截\r\nhttp.interceptors.request.use((config) => {\r\n\tconfig.data = config.data || {}\r\n\tconfig.header.token = uni.$tool.cache(\"token\")\r\n\t// console.log(config.header.token||'token为空')\r\n\treturn config \r\n}, config => {\r\n\treturn Promise.reject(config)\r\n})\r\n\r\n// 响应拦截\r\nhttp.interceptors.response.use(async(response) => {\r\n\tconst data = response.data\r\n\tif (data.code == 401) {\r\n\t\tconsole.log('token过期，重调')\r\n\t\tawait login.do()\r\n\t\tresponse.config.header.token = uni.$tool.cache(\"token\")\r\n\t\treturn http.request(response.config)\r\n\t}else if (data.code == 1) {\r\n\t\treturn Promise.resolve(data)\r\n\t}else{\r\n\t\tuni.$tool.tip(data.info||\"系统错误\",false,null,3)\r\n\t\treturn Promise.reject(data)\r\n\t}\r\n}, (response) => { \r\n\treturn Promise.reject(response)\r\n})\r\n\r\n\r\nconst doRequest = (url, data={}, auth=true, method=\"get\")=>{\r\n\tmethod = method.toUpperCase()\r\n\tlet config = {\r\n\t\tmethod,url\r\n\t}\r\n\tif(method == 'GET'){\r\n\t\tconfig.params = data\r\n\t}else{\r\n\t\tconfig.data = data\r\n\t}\r\n\treturn http.request(config)\r\n}\r\nconst doUpload = (url, data={}, auth=true)=>{\r\n\tlet config = {\r\n\t\t...data\r\n\t}\r\n\treturn http.upload(url, config)\r\n}\r\n\r\nexport default{\r\n\trequest(url, params, auth, method=\"get\"){\r\n\t\t// 数据加密传输\r\n\t\t// if(params) {\r\n\t\t// \tconst content = base64.base64Encode(JSON.stringify(params));\r\n\t\t// \tparams = {content};\r\n\t\t// }\r\n\t\treturn doRequest(url, params, auth, method);\r\n\t},\r\n\tget(url, params={}, auth=true){\r\n\t\turl = \"/api/\" + url;\r\n\t\treturn this.request(url, params, auth, \"get\");\r\n\t},\r\n\tpost(url, params={}, auth=true){\r\n\t\turl = \"/api/\" + url;\r\n\t\treturn this.request(url, params, auth, \"post\");\r\n\t},\r\n\tupload(url, params={}, auth=true){\r\n\t\turl = \"/api/\" + url;\r\n\t\treturn doUpload(url, params, auth);\r\n\t},\r\n\taddon: {\r\n\t\tget(url, params={}, auth=true){\r\n\t\t\turl = \"/addon\" + url;\r\n\t\t\treturn doRequest(url, params, auth, \"get\");\r\n\t\t},\r\n\t\tpost(url, params={}, auth=true){\r\n\t\t\turl = \"/addon\" + url;\r\n\t\t\treturn doRequest(url, params, auth, \"post\");\r\n\t\t},\r\n\t\tupload(url, params={}, auth=true){\r\n\t\t\turl = \"/addon\" + url;\r\n\t\t\treturn doUpload(url, params, auth);\r\n\t\t},\r\n\t}\r\n}"],"names":["Request","config","uni","login"],"mappings":";;;;;AAMA,MAAM,OAAO,IAAIA,gCAAAA;AAEjB,KAAK,UAAU,CAAC,YAAY;AACxB,UAAQ,UAAUC,cAAM,OAAC;AACzB,SAAO;AACX,CAAC;AAGD,KAAK,aAAa,QAAQ,IAAI,CAAC,WAAW;AACzC,SAAO,OAAO,OAAO,QAAQ,CAAE;AAC/B,SAAO,OAAO,QAAQC,cAAG,MAAC,MAAM,MAAM,OAAO;AAE7C,SAAO;AACR,GAAG,YAAU;AACZ,SAAO,QAAQ,OAAO,MAAM;AAC7B,CAAC;AAGD,KAAK,aAAa,SAAS,IAAI,OAAM,aAAa;AACjD,QAAM,OAAO,SAAS;AACtB,MAAI,KAAK,QAAQ,KAAK;AACrBA,kBAAAA,MAAA,MAAA,OAAA,wBAAY,YAAY;AACxB,UAAMC,aAAAA,MAAM,GAAI;AAChB,aAAS,OAAO,OAAO,QAAQD,cAAAA,MAAI,MAAM,MAAM,OAAO;AACtD,WAAO,KAAK,QAAQ,SAAS,MAAM;AAAA,EACrC,WAAW,KAAK,QAAQ,GAAG;AACzB,WAAO,QAAQ,QAAQ,IAAI;AAAA,EAC7B,OAAM;AACJA,wBAAI,MAAM,IAAI,KAAK,QAAM,QAAO,OAAM,MAAK,CAAC;AAC5C,WAAO,QAAQ,OAAO,IAAI;AAAA,EAC1B;AACF,GAAG,CAAC,aAAa;AAChB,SAAO,QAAQ,OAAO,QAAQ;AAC/B,CAAC;AAGD,MAAM,YAAY,CAAC,KAAK,OAAK,CAAA,GAAI,OAAK,MAAM,SAAO,UAAQ;AAC1D,WAAS,OAAO,YAAa;AAC7B,MAAI,SAAS;AAAA,IACZ;AAAA,IAAO;AAAA,EACP;AACD,MAAG,UAAU,OAAM;AAClB,WAAO,SAAS;AAAA,EAClB,OAAM;AACJ,WAAO,OAAO;AAAA,EACd;AACD,SAAO,KAAK,QAAQ,MAAM;AAC3B;AACA,MAAM,WAAW,CAAC,KAAK,OAAK,CAAA,GAAI,OAAK,SAAO;AAC3C,MAAI,SAAS;AAAA,IACZ,GAAG;AAAA,EACH;AACD,SAAO,KAAK,OAAO,KAAK,MAAM;AAC/B;AAEA,MAAc,SAAA;AAAA,EACb,QAAQ,KAAK,QAAQ,MAAM,SAAO,OAAM;AAMvC,WAAO,UAAU,KAAK,QAAQ,MAAM,MAAM;AAAA,EAC1C;AAAA,EACD,IAAI,KAAK,SAAO,CAAA,GAAI,OAAK,MAAK;AAC7B,UAAM,UAAU;AAChB,WAAO,KAAK,QAAQ,KAAK,QAAQ,MAAM,KAAK;AAAA,EAC5C;AAAA,EACD,KAAK,KAAK,SAAO,CAAA,GAAI,OAAK,MAAK;AAC9B,UAAM,UAAU;AAChB,WAAO,KAAK,QAAQ,KAAK,QAAQ,MAAM,MAAM;AAAA,EAC7C;AAAA,EACD,OAAO,KAAK,SAAO,CAAA,GAAI,OAAK,MAAK;AAChC,UAAM,UAAU;AAChB,WAAO,SAAS,KAAK,QAAQ,IAAI;AAAA,EACjC;AAAA,EACD,OAAO;AAAA,IACN,IAAI,KAAK,SAAO,CAAA,GAAI,OAAK,MAAK;AAC7B,YAAM,WAAW;AACjB,aAAO,UAAU,KAAK,QAAQ,MAAM,KAAK;AAAA,IACzC;AAAA,IACD,KAAK,KAAK,SAAO,CAAA,GAAI,OAAK,MAAK;AAC9B,YAAM,WAAW;AACjB,aAAO,UAAU,KAAK,QAAQ,MAAM,MAAM;AAAA,IAC1C;AAAA,IACD,OAAO,KAAK,SAAO,CAAA,GAAI,OAAK,MAAK;AAChC,YAAM,WAAW;AACjB,aAAO,SAAS,KAAK,QAAQ,IAAI;AAAA,IACjC;AAAA,EACD;AACF;;"}
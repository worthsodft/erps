{"version":3,"file":"utils.js","sources":["uni_modules/uni-file-picker/components/uni-file-picker/utils.js"],"sourcesContent":["/**\r\n * 获取文件名和后缀\r\n * @param {String} name\r\n */\r\nexport const get_file_ext = (name) => {\r\n\tconst last_len = name.lastIndexOf('.')\r\n\tconst len = name.length\r\n\treturn {\r\n\t\tname: name.substring(0, last_len),\r\n\t\text: name.substring(last_len + 1, len)\r\n\t}\r\n}\r\n\r\n/**\r\n * 获取扩展名\r\n * @param {Array} fileExtname\r\n */\r\nexport const get_extname = (fileExtname) => {\r\n\tif (!Array.isArray(fileExtname)) {\r\n\t\tlet extname = fileExtname.replace(/(\\[|\\])/g, '')\r\n\t\treturn extname.split(',')\r\n\t} else {\r\n\t\treturn fileExtname\r\n\t}\r\n\treturn []\r\n}\r\n\r\n/**\r\n * 获取文件和检测是否可选\r\n */\r\nexport const get_files_and_is_max = (res, _extname) => {\r\n\tlet filePaths = []\r\n\tlet files = []\r\n\tif(!_extname || _extname.length === 0){\r\n\t\treturn {\r\n\t\t\tfilePaths,\r\n\t\t\tfiles\r\n\t\t}\r\n\t}\r\n\tres.tempFiles.forEach(v => {\r\n\t\tlet fileFullName = get_file_ext(v.name)\r\n\t\tconst extname = fileFullName.ext.toLowerCase()\r\n\t\tif (_extname.indexOf(extname) !== -1) {\r\n\t\t\tfiles.push(v)\r\n\t\t\tfilePaths.push(v.path)\r\n\t\t}\r\n\t})\r\n\tif (files.length !== res.tempFiles.length) {\r\n\t\tuni.showToast({\r\n\t\t\ttitle: `当前选择了${res.tempFiles.length}个文件 ，${res.tempFiles.length - files.length} 个文件格式不正确`,\r\n\t\t\ticon: 'none',\r\n\t\t\tduration: 5000\r\n\t\t})\r\n\t}\r\n\r\n\treturn {\r\n\t\tfilePaths,\r\n\t\tfiles\r\n\t}\r\n}\r\n\r\n\r\n/**\r\n * 获取图片信息\r\n * @param {Object} filepath\r\n */\r\nexport const get_file_info = (filepath) => {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tuni.getImageInfo({\r\n\t\t\tsrc: filepath,\r\n\t\t\tsuccess(res) {\r\n\t\t\t\tresolve(res)\r\n\t\t\t},\r\n\t\t\tfail(err) {\r\n\t\t\t\treject(err)\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n}\r\n/**\r\n * 获取封装数据\r\n */\r\nexport const get_file_data = async (files, type = 'image') => {\r\n\t// 最终需要上传数据库的数据\r\n\tlet fileFullName = get_file_ext(files.name)\r\n\tconst extname = fileFullName.ext.toLowerCase()\r\n\tlet filedata = {\r\n\t\tname: files.name,\r\n\t\tuuid: files.uuid,\r\n\t\textname: extname || '',\r\n\t\tcloudPath: files.cloudPath,\r\n\t\tfileType: files.fileType,\n\t\tthumbTempFilePath: files.thumbTempFilePath,\r\n\t\turl: files.path || files.path,\r\n\t\tsize: files.size, //单位是字节\r\n\t\timage: {},\r\n\t\tpath: files.path,\r\n\t\tvideo: {}\r\n\t}\r\n\tif (type === 'image') {\r\n\t\tconst imageinfo = await get_file_info(files.path)\r\n\t\tdelete filedata.video\r\n\t\tfiledata.image.width = imageinfo.width\r\n\t\tfiledata.image.height = imageinfo.height\r\n\t\tfiledata.image.location = imageinfo.path\r\n\t} else {\r\n\t\tdelete filedata.image\r\n\t}\r\n\treturn filedata\r\n}\r\n"],"names":["uni"],"mappings":";;AAIO,MAAM,eAAe,CAAC,SAAS;AACrC,QAAM,WAAW,KAAK,YAAY,GAAG;AACrC,QAAM,MAAM,KAAK;AACjB,SAAO;AAAA,IACN,MAAM,KAAK,UAAU,GAAG,QAAQ;AAAA,IAChC,KAAK,KAAK,UAAU,WAAW,GAAG,GAAG;AAAA,EACrC;AACF;AAMY,MAAC,cAAc,CAAC,gBAAgB;AAC3C,MAAI,CAAC,MAAM,QAAQ,WAAW,GAAG;AAChC,QAAI,UAAU,YAAY,QAAQ,YAAY,EAAE;AAChD,WAAO,QAAQ,MAAM,GAAG;AAAA,EAC1B,OAAQ;AACN,WAAO;AAAA,EACP;AAEF;AAKY,MAAC,uBAAuB,CAAC,KAAK,aAAa;AACtD,MAAI,YAAY,CAAE;AAClB,MAAI,QAAQ,CAAE;AACd,MAAG,CAAC,YAAY,SAAS,WAAW,GAAE;AACrC,WAAO;AAAA,MACN;AAAA,MACA;AAAA,IACA;AAAA,EACD;AACD,MAAI,UAAU,QAAQ,OAAK;AAC1B,QAAI,eAAe,aAAa,EAAE,IAAI;AACtC,UAAM,UAAU,aAAa,IAAI,YAAa;AAC9C,QAAI,SAAS,QAAQ,OAAO,MAAM,IAAI;AACrC,YAAM,KAAK,CAAC;AACZ,gBAAU,KAAK,EAAE,IAAI;AAAA,IACrB;AAAA,EACH,CAAE;AACD,MAAI,MAAM,WAAW,IAAI,UAAU,QAAQ;AAC1CA,kBAAAA,MAAI,UAAU;AAAA,MACb,OAAO,QAAQ,IAAI,UAAU,MAAM,QAAQ,IAAI,UAAU,SAAS,MAAM,MAAM;AAAA,MAC9E,MAAM;AAAA,MACN,UAAU;AAAA,IACb,CAAG;AAAA,EACD;AAED,SAAO;AAAA,IACN;AAAA,IACA;AAAA,EACA;AACF;AAOO,MAAM,gBAAgB,CAAC,aAAa;AAC1C,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCA,kBAAAA,MAAI,aAAa;AAAA,MAChB,KAAK;AAAA,MACL,QAAQ,KAAK;AACZ,gBAAQ,GAAG;AAAA,MACX;AAAA,MACD,KAAK,KAAK;AACT,eAAO,GAAG;AAAA,MACV;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;AAIY,MAAC,gBAAgB,OAAO,OAAO,OAAO,YAAY;AAE7D,MAAI,eAAe,aAAa,MAAM,IAAI;AAC1C,QAAM,UAAU,aAAa,IAAI,YAAa;AAC9C,MAAI,WAAW;AAAA,IACd,MAAM,MAAM;AAAA,IACZ,MAAM,MAAM;AAAA,IACZ,SAAS,WAAW;AAAA,IACpB,WAAW,MAAM;AAAA,IACjB,UAAU,MAAM;AAAA,IAChB,mBAAmB,MAAM;AAAA,IACzB,KAAK,MAAM,QAAQ,MAAM;AAAA,IACzB,MAAM,MAAM;AAAA;AAAA,IACZ,OAAO,CAAE;AAAA,IACT,MAAM,MAAM;AAAA,IACZ,OAAO,CAAE;AAAA,EACT;AACD,MAAI,SAAS,SAAS;AACrB,UAAM,YAAY,MAAM,cAAc,MAAM,IAAI;AAChD,WAAO,SAAS;AAChB,aAAS,MAAM,QAAQ,UAAU;AACjC,aAAS,MAAM,SAAS,UAAU;AAClC,aAAS,MAAM,WAAW,UAAU;AAAA,EACtC,OAAQ;AACN,WAAO,SAAS;AAAA,EAChB;AACD,SAAO;AACR;;;;"}
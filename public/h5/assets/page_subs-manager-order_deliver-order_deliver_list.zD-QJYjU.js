import{a2 as e,a3 as t,e as a,o as l,c as s,w as o,a as i,t as n,l as u,b as c,x as r,f as d,n as m,v as h,F as p,r as f,g as _,h as v,U as g,j as y,C as b,i as k,z as C,s as x}from"./index-C-ZICx1j.js";import{_ as D}from"./uni-segmented-control.BxdIuh00.js";import{r as w,a as S,b as $}from"./uni-app.es.Cs0vIm-F.js";import{_ as V}from"./uni-section.DISfxe6Z.js";import{_ as j}from"./uni-datetime-picker.Bm0tR3qI.js";import{_ as I,a as R}from"./uni-data-checkbox.Pl1FAady.js";import{_ as K}from"./uni-load-more.CciThZeK.js";import{v as L}from"./v-order-item2-show.D2h0KIQ1.js";import{n as P}from"./uni-cloud.es.Di_WrJK_.js";import{_ as N}from"./uni-icons.BrqcvC_M.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";const A=O({name:"uni-data-select",mixins:[P.mixinDatacom||{}],props:{localdata:{type:Array,default:()=>[]},value:{type:[String,Number],default:""},modelValue:{type:[String,Number],default:""},label:{type:String,default:""},placeholder:{type:String,default:"请选择"},emptyTips:{type:String,default:"无选项"},clear:{type:Boolean,default:!0},defItem:{type:Number,default:0},disabled:{type:Boolean,default:!1},format:{type:String,default:""},placement:{type:String,default:"bottom"}},data:()=>({showSelector:!1,current:"",mixinDatacomResData:[],apps:[],channels:[],cacheKey:"uni-data-select-lastSelectedValue"}),created(){this.debounceGet=this.debounce((()=>{this.query()}),300),this.collection&&!this.localdata.length&&this.debounceGet()},computed:{typePlaceholder(){const e=this.placeholder,t={"opendb-stat-app-versions":"版本","opendb-app-channels":"渠道","opendb-app-list":"应用"}[this.collection];return t?e+t:e},valueCom(){return this.modelValue},textShow(){let e=this.current;return e.length>10?e.slice(0,25)+"...":e},getOffsetByPlacement(){switch(this.placement){case"top":return"bottom:calc(100% + 12px);";case"bottom":return"top:calc(100% + 12px);"}}},watch:{localdata:{immediate:!0,handler(e,t){Array.isArray(e)&&t!==e&&(this.mixinDatacomResData=e)}},valueCom(e,t){this.initDefVal()},mixinDatacomResData:{immediate:!0,handler(e){e.length&&this.initDefVal()}}},methods:{debounce(e,t=100){let a=null;return function(...l){a&&clearTimeout(a),a=setTimeout((()=>{e.apply(this,l)}),t)}},query(){this.mixinDatacomEasyGet()},onMixinDatacomPropsChange(){this.collection&&this.debounceGet()},initDefVal(){let e="";if(!this.valueCom&&0!==this.valueCom||this.isDisabled(this.valueCom)){let t;if(this.collection&&(t=this.getCache()),t||0===t)e=t;else{let t="";this.defItem>0&&this.defItem<=this.mixinDatacomResData.length&&(t=this.mixinDatacomResData[this.defItem-1].value),e=t}(e||0===e)&&this.emit(e)}else e=this.valueCom;const t=this.mixinDatacomResData.find((t=>t.value===e));this.current=t?this.formatItemName(t):""},isDisabled(e){let t=!1;return this.mixinDatacomResData.forEach((a=>{a.value===e&&(t=a.disable)})),t},clearVal(){this.emit(""),this.collection&&this.removeCache()},change(e){e.disable||(this.showSelector=!1,this.current=this.formatItemName(e),this.emit(e.value))},emit(e){this.$emit("input",e),this.$emit("update:modelValue",e),this.$emit("change",e),this.collection&&this.setCache(e)},toggleSelector(){this.disabled||(this.showSelector=!this.showSelector)},formatItemName(e){let{text:t,value:a,channel_code:l}=e;if(l=l?`(${l})`:"",this.format){let t="";t=this.format;for(let a in e)t=t.replace(new RegExp(`{${a}}`,"g"),e[a]);return t}return this.collection.indexOf("app-list")>0?`${t}(${a})`:t||`未命名${l}`},getLoadData(){return this.mixinDatacomResData},getCurrentCacheKey(){return this.collection},getCache(t=this.getCurrentCacheKey()){return(e(this.cacheKey)||{})[t]},setCache(a,l=this.getCurrentCacheKey()){let s=e(this.cacheKey)||{};s[l]=a,t(this.cacheKey,s)},removeCache(a=this.getCurrentCacheKey()){let l=e(this.cacheKey)||{};delete l[a],t(this.cacheKey,l)}}},[["render",function(e,t,y,b,k,C){const x=_,D=w(a("uni-icons"),N),S=v,$=g;return l(),s(x,{class:"uni-stat__select"},{default:o((()=>[y.label?(l(),i("span",{key:0,class:"uni-label-text hide-on-phone"},n(y.label+"："),1)):u("",!0),c(x,{class:r(["uni-stat-box",{"uni-stat__actived":k.current}])},{default:o((()=>[c(x,{class:r(["uni-select",{"uni-select--disabled":y.disabled}])},{default:o((()=>[c(x,{class:"uni-select__input-box",onClick:C.toggleSelector},{default:o((()=>[k.current?(l(),s(x,{key:0,class:"uni-select__input-text"},{default:o((()=>[d(n(C.textShow),1)])),_:1})):(l(),s(x,{key:1,class:"uni-select__input-text uni-select__input-placeholder"},{default:o((()=>[d(n(C.typePlaceholder),1)])),_:1})),k.current&&y.clear&&!y.disabled?(l(),s(x,{key:2,onClick:m(C.clearVal,["stop"])},{default:o((()=>[c(D,{type:"clear",color:"#c0c4cc",size:"24"})])),_:1},8,["onClick"])):(l(),s(x,{key:3},{default:o((()=>[c(D,{type:k.showSelector?"top":"bottom",size:"14",color:"#999"},null,8,["type"])])),_:1}))])),_:1},8,["onClick"]),k.showSelector?(l(),s(x,{key:0,class:"uni-select--mask",onClick:C.toggleSelector},null,8,["onClick"])):u("",!0),k.showSelector?(l(),s(x,{key:1,class:"uni-select__selector",style:h(C.getOffsetByPlacement)},{default:o((()=>[c(x,{class:r("bottom"==y.placement?"uni-popper__arrow_bottom":"uni-popper__arrow_top")},null,8,["class"]),c($,{"scroll-y":"true",class:"uni-select__selector-scroll"},{default:o((()=>[0===k.mixinDatacomResData.length?(l(),s(x,{key:0,class:"uni-select__selector-empty"},{default:o((()=>[c(S,null,{default:o((()=>[d(n(y.emptyTips),1)])),_:1})])),_:1})):(l(!0),i(p,{key:1},f(k.mixinDatacomResData,((e,t)=>(l(),s(x,{class:"uni-select__selector-item",key:t,onClick:t=>C.change(e)},{default:o((()=>[c(S,{class:r({"uni-select__selector__disabled":e.disable})},{default:o((()=>[d(n(C.formatItemName(e)),1)])),_:2},1032,["class"])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1},8,["style"])):u("",!0)])),_:1},8,["class"])])),_:1},8,["class"])])),_:1})}],["__scopeId","data-v-fe4b6be6"]]),T=O({__name:"v-goods-list",props:{list:Object,stationList:Array},emits:["confirm"],setup(e,{expose:t,emit:u}){const r=y(),m=y(""),h=u;function g(e){if(!m.value)return uni.$tool.tip("请选择水站信息");uni.$tool.confirm("确认需要配送的商品无误吗？",(()=>{h("confirm",m.value)}))}return t({open:function(){r.value.open("bottom")},close:function(){r.value.close()}}),(t,u)=>{const h=_,y=v,x=w(a("uni-data-select"),A),D=k,S=C,$=w(a("uni-popup"),I);return l(),s(h,null,{default:o((()=>[c($,{ref_key:"itemPopup",ref:r,"background-color":"#fff"},{default:o((()=>[c(h,{class:"item-popup-main"},{default:o((()=>[c(h,{class:"item-popup-main-title"},{default:o((()=>[d("当前配货商品 ")])),_:1}),c(h,{class:"station-list"},{default:o((()=>[c(y,null,{default:o((()=>[d("选择水站：")])),_:1}),c(h,{style:{width:"450rpx"}},{default:o((()=>[c(x,{modelValue:m.value,"onUpdate:modelValue":u[0]||(u[0]=e=>m.value=e),localdata:e.stationList,onChange:t.stationChange},null,8,["modelValue","localdata","onChange"])])),_:1})])),_:1}),c(h,{class:"item-popup-main-list"},{default:o((()=>[(l(!0),i(p,null,f(e.list,((e,t)=>(l(),s(h,{class:"select-item",key:e.goods_sn,onClick:t=>{return a=e.goods_cover,void b({urls:[a]});var a}},{default:o((()=>[c(h,{class:"select-item-left"},{default:o((()=>[c(h,{class:"row"},{default:o((()=>[c(D,{class:"goods-cover",src:e.goods_cover||"",mode:"aspectFill"},null,8,["src"]),c(y,{class:"value"},{default:o((()=>[d(n(e.goods_name),1)])),_:2},1024),c(y,{class:"value v-font-s30 v-ml-40"},{default:o((()=>[d(n(e.goods_number)+" "+n(e.goods_unit),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),c(h,{class:"select-item v-no-border"},{default:o((()=>[c(S,{onClick:g,type:"primary",style:{width:"80%","background-color":"#5aa1d8",color:"#fff"}},{default:o((()=>[d("确认配货")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},512)])),_:1})}}},[["__scopeId","data-v-94e462f3"]]),G=O({__name:"order_deliver_list",setup(e){const t=y(0),n=y("支付时间"),r=y([]),m=y([]);let h=uni.$tool.today();const v=y([h,h]),g=y("more"),b=y([]);y({});const k=y(0);let C=1;const I=y({}),P=y(0),N=y(),O=y([]);function A(e){let t=[];if(b.value.forEach((e=>{e.checked&&t.push(e.sn)})),!e)return uni.$tool.tip("请选择水站信息");uni.$http.post("v1/orderPick",{sns:t,station_gid:e}).then((e=>{if(1!=e.code)return uni.$tool.tip(e.info||"系统错误");uni.$tool.tip(e.info||"操作成功"),F(),q("reset"),N.value.close()}))}function G(){if(!I.value||0==Object.keys(I.value).length)return uni.$tool.tip("请选择配货商品");N.value.open()}function U(e){let t=b.value[e];if(t.checked=!t.checked,t.checked){for(let e in t.subs){let a=t.subs[e];I.value[a.goods_sn]?I.value[a.goods_sn].goods_number+=a.goods_number:I.value[a.goods_sn]={goods_sn:a.goods_sn,goods_cover:a.goods_cover,goods_name:a.goods_name,goods_number:a.goods_number,goods_unit:a.goods_unit},P.value+=a.goods_number}uni.$tool.tip("配货商品已添加")}else{for(let e in t.subs){let a=t.subs[e],l=I.value[a.goods_sn].goods_number-a.goods_number;l<=0?delete I.value[a.goods_sn]:I.value[a.goods_sn].goods_number=l,P.value-=a.goods_number}uni.$tool.tip("配货商品已去除")}b.value[e]=t}function B({currentIndex:e}){t.value=e,n.value=0==e?"支付时间":"配送时间",I.value={},P.value=0,F(),b.value=[],q("reset")}function E(e){0==e.length?v.value=[h,h]:v.value=e,F(),q("reset")}function z({detail:e}){F(),q("reset")}function F(){g.value="more",C=1}function q(e){if("more"!=g.value)return;g.value="loading";let a={page:C,takeAtRange:v.value,current:t.value,district:r.value};uni.$http.post("v1/getMyDeliverOrderPageData",a).then((t=>{if(1!=t.code)return uni.$tool.tip(t.info||"系统错误");let a=t.data.pageData;if(k.value=a.total,0==a.total)return g.value="nomore",b.value=[],void(P.value=0);0!=a.data.length?(b.value="reset"==e?[...a.data]:[...b.value,...a.data],b.value.length>=k.value?g.value="nomore":(g.value="more",C++)):g.value="nomore"}))}return uni.$http.post("v1/getUserInfoDistricts").then((e=>{m.value=e.data.districts})),q(),uni.$http.post("v1/getStationOpeningList").then((e=>{O.value=e.data.stationList})),S((()=>{q()})),$((()=>{F(),q("reset"),setTimeout((()=>{x()}),200)})),(e,h)=>{const y=w(a("uni-segmented-control"),D),C=_,x=w(a("uni-section"),V),S=w(a("uni-datetime-picker"),j),$=w(a("uni-data-checkbox"),R),F=w(a("uni-load-more"),K);return l(),s(C,{class:"container-v order-finish-list"},{default:o((()=>[c(C,{class:"v-w100 v-mb-10",style:{"text-align":"center"}},{default:o((()=>[c(C,{style:{width:"90%","margin-left":"5%"}},{default:o((()=>[c(y,{activeColor:"#6abfff",current:t.value,values:["待配货","配送中","已配送"],onClickItem:B,styleType:"button"},null,8,["current"])])),_:1})])),_:1}),c(C,{class:"v-w100 v-mb-10"},{default:o((()=>[c(x,{title:n.value+"：",type:"line"},null,8,["title"]),c(C,{style:{width:"90%","margin-left":"5%"}},{default:o((()=>[c(S,{modelValue:v.value,"onUpdate:modelValue":h[0]||(h[0]=e=>v.value=e),type:"daterange",onChange:E,rangeSeparator:"至"},null,8,["modelValue"])])),_:1}),c(x,{title:"配送区域：",type:"line"}),c(C,{style:{width:"90%","margin-left":"5%"}},{default:o((()=>[c($,{modelValue:r.value,"onUpdate:modelValue":h[1]||(h[1]=e=>r.value=e),multiple:"",localdata:m.value,onChange:z},null,8,["modelValue","localdata"])])),_:1}),c(x,{title:"总订单数："+k.value,type:"line"},null,8,["title"]),0==t.value?(l(),s(x,{key:0,title:"配货商品总件数："+P.value+" 件",type:"line"},{right:o((()=>[c(C,{class:"btn-sm btn-red v-mr-20",onClick:G},{default:o((()=>[d("确定配货")])),_:1})])),_:1},8,["title"])):u("",!0)])),_:1}),c(C,{class:"order-finish-item"},{default:o((()=>[(l(!0),i(p,null,f(b.value,((e,t)=>(l(),s(C,{key:e.id},{default:o((()=>[c(L,{item:e,index:t,onSelect:U},null,8,["item","index"])])),_:2},1024)))),128)),c(F,{status:g.value,onClick:q},null,8,["status"])])),_:1}),c(T,{ref_key:"goodsListRef",ref:N,list:I.value,stationList:O.value,onConfirm:A},null,8,["list","stationList"])])),_:1})}}},[["__scopeId","data-v-1741b4e8"]]);export{G as default};

import{R as e,X as t,Y as l,Z as i,_ as s,C as a,o,c as r,w as n,a as u,F as d,r as c,v as p,b as h,n as f,l as m,f as y,N as g,i as v,g as _,$ as b,x as k,t as F,G as x,h as w,z as $,j as P,e as I,O as T,u as S,V as C,W as L}from"./index-C0uxPSrd.js";import{_ as j,a as M}from"./uni-data-checkbox.m_03FTGu.js";import{r as O,d as E}from"./uni-app.es.riDY3n56.js";import{_ as V}from"./uni-icons.D4sVfuiR.js";import{_ as A,a as D,b as U}from"./v-order-confirm-bar2.Du-9HP6s.js";import{n as B}from"./uni-cloud.es.BCewyeLg.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as N}from"./uni-easyinput.BcFWWB_E.js";import{_ as R}from"./v-button-w80.CkkdNAZw.js";import"./uni-load-more.DWacGKnG.js";const H="chooseAndUploadFile:fail";function J(e,t){return e.tempFiles.forEach(((e,l)=>{e.name||(e.name=e.path.substring(e.path.lastIndexOf("/")+1)),t&&(e.fileType=t),e.cloudPath=Date.now()+"_"+l+e.name.substring(e.name.lastIndexOf("."))})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((e=>e.path))),e}function q(e,t=5,l){const i=(e=JSON.parse(JSON.stringify(e))).length;let s=0,a=this;return new Promise((o=>{for(;s<t;)r();function r(){let t=s++;if(t>=i)return void(!e.find((e=>!e.url&&!e.errMsg))&&o(e));const n=e[t],u=a.files.findIndex((e=>e.uuid===n.uuid));n.url="",delete n.errMsg,B.uploadFile({filePath:n.path,cloudPath:n.cloudPath,fileType:n.fileType,onUploadProgress:e=>{e.index=u,l&&l(e)}}).then((e=>{n.url=e.fileID,n.index=u,t<i&&r()})).catch((e=>{n.errMsg=e.errMsg||e.message,n.index=u,t<i&&r()}))}}))}function G(e,{onChooseFile:t,onUploadProgress:l}){return e.then((e=>{if(t){const l=t(e);if(void 0!==l)return Promise.resolve(l).then((t=>void 0===t?e:t))}return e})).then((e=>!1===e?{errMsg:"chooseAndUploadFile:ok",tempFilePaths:[],tempFiles:[]}:e))}function W(i={type:"all"}){return"image"===i.type?G(function(t){const{count:l,sizeType:i=["original","compressed"],sourceType:s,extension:a}=t;return new Promise(((t,o)=>{e({count:l,sizeType:i,sourceType:s,extension:a,success(e){t(J(e,"image"))},fail(e){o({errMsg:e.errMsg.replace("chooseImage:fail",H)})}})}))}(i),i):"video"===i.type?G(function(e){const{count:l,camera:i,compressed:s,maxDuration:a,sourceType:o,extension:r}=e;return new Promise(((e,l)=>{t({camera:i,compressed:s,maxDuration:a,sourceType:o,extension:r,success(t){const{tempFilePath:l,duration:i,size:s,height:a,width:o}=t;e(J({errMsg:"chooseVideo:ok",tempFilePaths:[l],tempFiles:[{name:t.tempFile&&t.tempFile.name||"",path:l,size:s,type:t.tempFile&&t.tempFile.type||"",width:o,height:a,duration:i,fileType:"video",cloudPath:""}]},"video"))},fail(e){l({errMsg:e.errMsg.replace("chooseVideo:fail",H)})}})}))}(i),i):G(function(e){const{count:t,extension:i}=e;return new Promise(((e,s)=>{let a=l;if("undefined"!=typeof wx&&"function"==typeof wx.chooseMessageFile&&(a=wx.chooseMessageFile),"function"!=typeof a)return s({errMsg:H+" 请指定 type 类型，该平台仅支持选择 image 或 video。"});a({type:"all",count:t,extension:i,success(t){e(J(t))},fail(e){s({errMsg:e.errMsg.replace("chooseFile:fail",H)})}})}))}(i),i)}const X=e=>{const t=e.lastIndexOf("."),l=e.length;return{name:e.substring(0,t),ext:e.substring(t+1,l)}},Y=e=>{if(Array.isArray(e))return e;return e.replace(/(\[|\])/g,"").split(",")},Z=async(e,t="image")=>{const l=X(e.name).ext.toLowerCase();let i={name:e.name,uuid:e.uuid,extname:l||"",cloudPath:e.cloudPath,fileType:e.fileType,thumbTempFilePath:e.thumbTempFilePath,url:e.path||e.path,size:e.size,image:{},path:e.path,video:{}};if("image"===t){const t=await(a=e.path,new Promise(((e,t)=>{s({src:a,success(t){e(t)},fail(e){t(e)}})})));delete i.video,i.image.width=t.width,i.image.height=t.height,i.image.location=t.path}else delete i.image;var a;return i};const K=z({name:"uniFilePicker",components:{uploadImage:z({name:"uploadImage",emits:["uploadFiles","choose","delFile"],props:{filesList:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},disablePreview:{type:Boolean,default:!1},limit:{type:[Number,String],default:9},imageStyles:{type:Object,default:()=>({width:"auto",height:"auto",border:{}})},delIcon:{type:Boolean,default:!0},readonly:{type:Boolean,default:!1}},computed:{styles(){return Object.assign({width:"auto",height:"auto",border:{}},this.imageStyles)},boxStyle(){const{width:e="auto",height:t="auto"}=this.styles;let l={};"auto"===t?"auto"!==e?(l.height=this.value2px(e),l["padding-top"]=0):l.height=0:(l.height=this.value2px(t),l["padding-top"]=0),l.width="auto"===e?"auto"!==t?this.value2px(t):"33.3%":this.value2px(e);let i="";for(let s in l)i+=`${s}:${l[s]};`;return i},borderStyle(){let{border:e}=this.styles,t={};if("boolean"==typeof e)t.border=e?"1px #eee solid":"none";else{let l=e&&e.width||1;l=this.value2px(l);let i=e&&e.radius||3;i=this.value2px(i),t={"border-width":l,"border-style":e&&e.style||"solid","border-color":e&&e.color||"#eee","border-radius":i}}let l="";for(let i in t)l+=`${i}:${t[i]};`;return l}},methods:{uploadFiles(e,t){this.$emit("uploadFiles",e)},choose(){this.$emit("choose")},delFile(e){this.$emit("delFile",e)},prviewImage(e,t){let l=[];1===Number(this.limit)&&this.disablePreview&&!this.disabled&&this.$emit("choose"),this.disablePreview||(this.filesList.forEach((e=>{l.push(e.url)})),a({urls:l,current:t}))},value2px:e=>("number"==typeof e?e+="px":-1===e.indexOf("%")&&(e=-1!==e.indexOf("px")?e:e+"px"),e)}},[["render",function(e,t,l,i,s,a){const k=v,F=_,x=b;return o(),r(F,{class:"uni-file-picker__container"},{default:n((()=>[(o(!0),u(d,null,c(l.filesList,((e,t)=>(o(),r(F,{class:"file-picker__box",key:t,style:p(a.boxStyle)},{default:n((()=>[h(F,{class:"file-picker__box-content",style:p(a.borderStyle)},{default:n((()=>[h(k,{class:"file-image",src:e.url,mode:"aspectFill",onClick:f((l=>a.prviewImage(e,t)),["stop"])},null,8,["src","onClick"]),l.delIcon&&!l.readonly?(o(),r(F,{key:0,class:"icon-del-box",onClick:f((e=>a.delFile(t)),["stop"])},{default:n((()=>[h(F,{class:"icon-del"}),h(F,{class:"icon-del rotate"})])),_:2},1032,["onClick"])):m("",!0),e.progress&&100!==e.progress||0===e.progress?(o(),r(F,{key:1,class:"file-picker__progress"},{default:n((()=>[h(x,{class:"file-picker__progress-item",percent:-1===e.progress?0:e.progress,"stroke-width":"4",backgroundColor:e.errMsg?"#ff5a5f":"#EBEBEB"},null,8,["percent","backgroundColor"])])),_:2},1024)):m("",!0),e.errMsg?(o(),r(F,{key:2,class:"file-picker__mask",onClick:f((l=>a.uploadFiles(e,t)),["stop"])},{default:n((()=>[y(" 点击重试 ")])),_:2},1032,["onClick"])):m("",!0)])),_:2},1032,["style"])])),_:2},1032,["style"])))),128)),l.filesList.length<l.limit&&!l.readonly?(o(),r(F,{key:0,class:"file-picker__box",style:p(a.boxStyle)},{default:n((()=>[h(F,{class:"file-picker__box-content is-add",style:p(a.borderStyle),onClick:a.choose},{default:n((()=>[g(e.$slots,"default",{},(()=>[h(F,{class:"icon-add"}),h(F,{class:"icon-add rotate"})]),!0)])),_:3},8,["style","onClick"])])),_:3},8,["style"])):m("",!0)])),_:3})}],["__scopeId","data-v-86b162f5"]]),uploadFile:z({name:"uploadFile",emits:["uploadFiles","choose","delFile"],props:{filesList:{type:Array,default:()=>[]},delIcon:{type:Boolean,default:!0},limit:{type:[Number,String],default:9},showType:{type:String,default:""},listStyles:{type:Object,default:()=>({border:!0,dividline:!0,borderStyle:{}})},readonly:{type:Boolean,default:!1}},computed:{list(){let e=[];return this.filesList.forEach((t=>{e.push(t)})),e},styles(){return Object.assign({border:!0,dividline:!0,"border-style":{}},this.listStyles)},borderStyle(){let{borderStyle:e,border:t}=this.styles,l={};if(t){let t=e&&e.width||1;t=this.value2px(t);let i=e&&e.radius||5;i=this.value2px(i),l={"border-width":t,"border-style":e&&e.style||"solid","border-color":e&&e.color||"#eee","border-radius":i}}else l.border="none";let i="";for(let s in l)i+=`${s}:${l[s]};`;return i},borderLineStyle(){let e={},{borderStyle:t}=this.styles;if(t&&t.color&&(e["border-color"]=t.color),t&&t.width){let l=t&&t.width||1,i=t&&t.style||0;"number"==typeof l?l+="px":l=l.indexOf("px")?l:l+"px",e["border-width"]=l,"number"==typeof i?i+="px":i=i.indexOf("px")?i:i+"px",e["border-top-style"]=i}let l="";for(let i in e)l+=`${i}:${e[i]};`;return l}},methods:{uploadFiles(e,t){this.$emit("uploadFiles",{item:e,index:t})},choose(){this.$emit("choose")},delFile(e){this.$emit("delFile",e)},value2px:e=>("number"==typeof e?e+="px":e=-1!==e.indexOf("px")?e:e+"px",e)}},[["render",function(e,t,l,i,s,a){const v=_,x=b;return o(),r(v,{class:"uni-file-picker__files"},{default:n((()=>[l.readonly?m("",!0):(o(),r(v,{key:0,class:"files-button",onClick:a.choose},{default:n((()=>[g(e.$slots,"default",{},void 0,!0)])),_:3},8,["onClick"])),a.list.length>0?(o(),r(v,{key:1,class:"uni-file-picker__lists is-text-box",style:p(a.borderStyle)},{default:n((()=>[(o(!0),u(d,null,c(a.list,((e,t)=>(o(),r(v,{class:k(["uni-file-picker__lists-box",{"files-border":0!==t&&a.styles.dividline}]),key:t,style:p(0!==t&&a.styles.dividline&&a.borderLineStyle)},{default:n((()=>[h(v,{class:"uni-file-picker__item"},{default:n((()=>[h(v,{class:"files__name"},{default:n((()=>[y(F(e.name),1)])),_:2},1024),l.delIcon&&!l.readonly?(o(),r(v,{key:0,class:"icon-del-box icon-files",onClick:e=>a.delFile(t)},{default:n((()=>[h(v,{class:"icon-del icon-files"}),h(v,{class:"icon-del rotate"})])),_:2},1032,["onClick"])):m("",!0)])),_:2},1024),e.progress&&100!==e.progress||0===e.progress?(o(),r(v,{key:0,class:"file-picker__progress"},{default:n((()=>[h(x,{class:"file-picker__progress-item",percent:-1===e.progress?0:e.progress,"stroke-width":"4",backgroundColor:e.errMsg?"#ff5a5f":"#EBEBEB"},null,8,["percent","backgroundColor"])])),_:2},1024)):m("",!0),"error"===e.status?(o(),r(v,{key:1,class:"file-picker__mask",onClick:f((l=>a.uploadFiles(e,t)),["stop"])},{default:n((()=>[y(" 点击重试 ")])),_:2},1032,["onClick"])):m("",!0)])),_:2},1032,["class","style"])))),128))])),_:1},8,["style"])):m("",!0)])),_:3})}],["__scopeId","data-v-5d376bd5"]])},options:{virtualHost:!0},emits:["select","success","fail","progress","delete","update:modelValue","input"],props:{modelValue:{type:[Array,Object],default:()=>[]},disabled:{type:Boolean,default:!1},disablePreview:{type:Boolean,default:!1},delIcon:{type:Boolean,default:!0},autoUpload:{type:Boolean,default:!0},limit:{type:[Number,String],default:9},mode:{type:String,default:"grid"},fileMediatype:{type:String,default:"image"},fileExtname:{type:[Array,String],default:()=>[]},title:{type:String,default:""},listStyles:{type:Object,default:()=>({border:!0,dividline:!0,borderStyle:{}})},imageStyles:{type:Object,default:()=>({width:"auto",height:"auto"})},readonly:{type:Boolean,default:!1},returnType:{type:String,default:"array"},sizeType:{type:Array,default:()=>["original","compressed"]},sourceType:{type:Array,default:()=>["album","camera"]},provider:{type:String,default:""}},data:()=>({files:[],localValue:[]}),watch:{modelValue:{handler(e,t){this.setValue(e,t)},immediate:!0}},computed:{filesList(){let e=[];return this.files.forEach((t=>{e.push(t)})),e},showType(){return"image"===this.fileMediatype?this.mode:"list"},limitLength(){return"object"===this.returnType?1:this.limit?this.limit>=9?9:this.limit:1}},created(){B.config&&B.config.provider||(this.noSpace=!0,B.chooseAndUploadFile=W),this.form=this.getForm("uniForms"),this.formItem=this.getForm("uniFormsItem"),this.form&&this.formItem&&this.formItem.name&&(this.rename=this.formItem.name,this.form.inputChildrens.push(this))},methods:{clearFiles(e){0===e||e?this.files.splice(e,1):(this.files=[],this.$nextTick((()=>{this.setEmit()}))),this.$nextTick((()=>{this.setEmit()}))},upload(){let e=[];return this.files.forEach(((t,l)=>{"ready"!==t.status&&"error"!==t.status||e.push(Object.assign({},t))})),this.uploadFiles(e)},async setValue(e,t){const l=async e=>{let t="";return t=e.fileID?e.fileID:e.url,/cloud:\/\/([\w.]+\/?)\S*/.test(t)&&(e.fileID=t,e.url=await this.getTempFileURL(t)),e.url&&(e.path=e.url),e};if("object"===this.returnType)e?await l(e):e={};else{e||(e=[]);for(let t=0;t<e.length;t++){let i=e[t];await l(i)}}this.localValue=e,this.form&&this.formItem&&!this.is_reset&&(this.is_reset=!1,this.formItem.setValue(this.localValue));let i=Object.keys(e).length>0?e:[];this.files=[].concat(i)},choose(){this.disabled||(this.files.length>=Number(this.limitLength)&&"grid"!==this.showType&&"array"===this.returnType?i({title:`您最多选择 ${this.limitLength} 个文件`,icon:"none"}):this.chooseFiles())},chooseFiles(){const e=Y(this.fileExtname);B.chooseAndUploadFile({type:this.fileMediatype,compressed:!1,sizeType:this.sizeType,sourceType:this.sourceType,extension:e.length>0?e:void 0,count:this.limitLength-this.files.length,onChooseFile:this.chooseFileCallback,onUploadProgress:e=>{this.setProgress(e,e.index)}}).then((e=>{this.setSuccessAndError(e.tempFiles)})).catch((e=>{console.log("选择失败",e)}))},async chooseFileCallback(e){const t=Y(this.fileExtname);(1===Number(this.limitLength)&&this.disablePreview&&!this.disabled||"object"===this.returnType)&&(this.files=[]);let{filePaths:l,files:s}=((e,t)=>{let l=[],s=[];return t&&0!==t.length?(e.tempFiles.forEach((e=>{const i=X(e.name).ext.toLowerCase();-1!==t.indexOf(i)&&(s.push(e),l.push(e.path))})),s.length!==e.tempFiles.length&&i({title:`当前选择了${e.tempFiles.length}个文件 ，${e.tempFiles.length-s.length} 个文件格式不正确`,icon:"none",duration:5e3}),{filePaths:l,files:s}):{filePaths:l,files:s}})(e,t);t&&t.length>0||(l=e.tempFilePaths,s=e.tempFiles);let a=[];for(let i=0;i<s.length&&!(this.limitLength-this.files.length<=0);i++){s[i].uuid=Date.now();let e=await Z(s[i],this.fileMediatype);e.progress=0,e.status="ready",this.files.push(e),a.push({...e,file:s[i]})}this.$emit("select",{tempFiles:a,tempFilePaths:l}),e.tempFiles=s,this.autoUpload&&!this.noSpace||(e.tempFiles=[]),e.tempFiles.forEach(((e,t)=>{this.provider&&(e.provider=this.provider);const l=e.name.split("."),i=l.pop(),s=l.join(".").replace(/[\s\/\?<>\\:\*\|":]/g,"_");e.cloudPath=s+"_"+Date.now()+"_"+t+"."+i}))},uploadFiles(e){return e=[].concat(e),q.call(this,e,5,(e=>{this.setProgress(e,e.index,!0)})).then((e=>(this.setSuccessAndError(e),e))).catch((e=>{console.log(e)}))},async setSuccessAndError(e,t){let l=[],i=[],s=[],a=[];for(let o=0;o<e.length;o++){const t=e[o],r=t.uuid?this.files.findIndex((e=>e.uuid===t.uuid)):t.index;if(-1===r||!this.files)break;if("request:fail"===t.errMsg)this.files[r].url=t.path,this.files[r].status="error",this.files[r].errMsg=t.errMsg,i.push(this.files[r]),a.push(this.files[r].url);else{this.files[r].errMsg="",this.files[r].fileID=t.url;/cloud:\/\/([\w.]+\/?)\S*/.test(t.url)?this.files[r].url=await this.getTempFileURL(t.url):this.files[r].url=t.url,this.files[r].status="success",this.files[r].progress+=1,l.push(this.files[r]),s.push(this.files[r].fileID)}}l.length>0&&(this.setEmit(),this.$emit("success",{tempFiles:this.backObject(l),tempFilePaths:s})),i.length>0&&this.$emit("fail",{tempFiles:this.backObject(i),tempFilePaths:a})},setProgress(e,t,l){this.files.length;const i=Math.round(100*e.loaded/e.total);let s=t;l||(s=this.files.findIndex((t=>t.uuid===e.tempFile.uuid))),-1!==s&&this.files[s]&&(this.files[s].progress=i-1,this.$emit("progress",{index:s,progress:parseInt(i),tempFile:this.files[s]}))},delFile(e){this.$emit("delete",{index:e,tempFile:this.files[e],tempFilePath:this.files[e].url}),this.files.splice(e,1),this.$nextTick((()=>{this.setEmit()}))},getFileExt(e){const t=e.lastIndexOf("."),l=e.length;return{name:e.substring(0,t),ext:e.substring(t+1,l)}},setEmit(){let e=[];"object"===this.returnType?(e=this.backObject(this.files)[0],this.localValue=e||null):(e=this.backObject(this.files),this.localValue||(this.localValue=[]),this.localValue=[...e]),this.$emit("update:modelValue",this.localValue)},backObject(e){let t=[];return e.forEach((e=>{t.push({extname:e.extname,fileType:e.fileType,image:e.image,name:e.name,path:e.path,size:e.size,fileID:e.fileID,url:e.url,uuid:e.uuid,status:e.status,cloudPath:e.cloudPath})})),t},async getTempFileURL(e){e={fileList:[].concat(e)};return(await B.getTempFileURL(e)).fileList[0].tempFileURL||""},getForm(e="uniForms"){let t=this.$parent,l=t.$options.name;for(;l!==e;){if(t=t.$parent,!t)return!1;l=t.$options.name}return t}}},[["render",function(e,t,l,i,s,a){const u=w,d=_,c=x("upload-image"),p=$,f=x("upload-file");return o(),r(d,{class:"uni-file-picker"},{default:n((()=>[l.title?(o(),r(d,{key:0,class:"uni-file-picker__header"},{default:n((()=>[h(u,{class:"file-title"},{default:n((()=>[y(F(l.title),1)])),_:1}),h(u,{class:"file-count"},{default:n((()=>[y(F(a.filesList.length)+"/"+F(a.limitLength),1)])),_:1})])),_:1})):m("",!0),"image"===l.fileMediatype&&"grid"===a.showType?(o(),r(c,{key:1,readonly:l.readonly,"image-styles":l.imageStyles,"files-list":a.filesList,limit:a.limitLength,disablePreview:l.disablePreview,delIcon:l.delIcon,onUploadFiles:a.uploadFiles,onChoose:a.choose,onDelFile:a.delFile},{default:n((()=>[g(e.$slots,"default",{},(()=>[h(d,{class:"is-add"},{default:n((()=>[h(d,{class:"icon-add"}),h(d,{class:"icon-add rotate"})])),_:1})]),!0)])),_:3},8,["readonly","image-styles","files-list","limit","disablePreview","delIcon","onUploadFiles","onChoose","onDelFile"])):m("",!0),"image"!==l.fileMediatype||"grid"!==a.showType?(o(),r(f,{key:2,readonly:l.readonly,"list-styles":l.listStyles,"files-list":a.filesList,showType:a.showType,delIcon:l.delIcon,onUploadFiles:a.uploadFiles,onChoose:a.choose,onDelFile:a.delFile},{default:n((()=>[g(e.$slots,"default",{},(()=>[h(p,{type:"primary",size:"mini"},{default:n((()=>[y("选择文件")])),_:1})]),!0)])),_:3},8,["readonly","list-styles","files-list","showType","delIcon","onUploadFiles","onChoose","onDelFile"])):m("",!0)])),_:3})}],["__scopeId","data-v-c3437fa4"]]),Q=z({__name:"v-deliver-images",props:{images:Array,sn:String},emits:["success"],setup(e,{expose:t,emit:l}){const i=e,s=P(),a=P("");let u=[],d=[];const c=l;let p=uni.$tool.throttle((()=>{if(0==d.length)return uni.$tool.tip("请上传配送照片");uni.$tool.confirm("是否确认已送达？",(()=>{uni.$tool.showLoading("上传中..."),async function(e){u=[];for(let t in d){let e={filePath:d[t],name:"file"};const l=await uni.$http.upload("v1/upload",e);u.push(l.data.url)}e&&e()}((()=>{uni.$tool.hideLoading();let e={sn:i.sn,urls:u,remark:a.value};uni.$http.post("v1/deliverOrder",e).then((e=>{1==e.code?(uni.$tool.tip(e.info||"操作成功"),g(),c("success")):uni.$tool.tip(e.info||"系统错误")}))}))}))}),1e3);function f({tempFilePaths:e}){d=[...d,...e]}function m({index:e}){d.splice(e,1)}function g(){s.value.close()}function v(e){}return t({open:function(){s.value.open("bottom")},close:g}),(e,t)=>{const l=_,i=O(I("uni-file-picker"),K),u=w,d=O(I("uni-easyinput"),N),c=O(I("v-button-w80"),R),g=O(I("uni-popup"),j);return o(),r(l,null,{default:n((()=>[h(g,{ref_key:"itemPopup",ref:s,"background-color":"#fff",onChange:v},{default:n((()=>[h(l,{class:"item-popup-main"},{default:n((()=>[h(l,{class:"item-popup-main-title"},{default:n((()=>[y("上传配送照片")])),_:1}),h(l,{class:"item-popup-main-list"},{default:n((()=>[h(l,{class:"image-list"},{default:n((()=>[h(i,{limit:"3",title:"最多选择3张图片",onSelect:f,onDelete:m}),h(l,{class:"deliver-remark"},{default:n((()=>[y("配送说明"),h(u,{class:"tip"},{default:n((()=>[y(" (最多可输入200字)")])),_:1})])),_:1}),h(l,{class:"deliver-textarea"},{default:n((()=>[h(d,{type:"textarea",maxlength:"200",modelValue:a.value,"onUpdate:modelValue":t[0]||(t[0]=e=>a.value=e),placeholder:"请输入配送说明"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),h(c,{onAction:T(p),title:"确定提交"},null,8,["onAction"]),h(l,{style:{weight:"100%",height:"40rpx"}})])),_:1},512)])),_:1})}}},[["__scopeId","data-v-49456e39"]]),ee=z({__name:"detail",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(e){P(uni.$enum),P("去使用");const t=P(),l=P({}),i=P("");let s=P([]),p={},f=-1,g=S(e,"modelValue");const b=P(),k=P([]);function x(){b.value.open()}function $(){q()}const j=P({});let B=P({}),z=P({}),N={weixin:"微信",yue:"余额"},R=P(""),H="";E((e=>{uni.$http.post("v1/getInitDataConfirm",p).then((e=>{s.value=e.data.takeTypes})),e.sn&&(H=e.sn,uni.$tool.setNavTitle("订单查看"),uni.$login.judgeLogin((()=>{q()})))}));const J=()=>{const e="订单编号："+l.value.sn;L({data:e,success(e){uni.$tool.tip("订单编号已复制")}})};function q(){uni.$tool.showLoading(),uni.$http.post("v1/getOrderDetail/"+H).then((e=>{uni.$tool.hideLoading(),l.value=e.data.order,g.value=l.value.remark,R.value=l.value.pay_type||"",z.value=e.data.station,B.value=e.data.address,j.value=e.data.coupon}))}function G(){uni.$tool.back()}return(e,p)=>{const P=_,S=O(I("uni-data-checkbox"),M),L=w,E=O(I("uni-icons"),V),H=O(I("v-order-sub-item2"),A),q=O(I("v-order-info-item"),D),W=v,X=O(I("v-order-confirm-bar2"),U),Y=O(I("v-deliver-images"),Q);return o(),r(P,{class:"container-v confirm"},{default:n((()=>[t.value?(o(),u(d,{key:0},[h(P,{class:"take-type"},{default:n((()=>[h(P,null,{default:n((()=>[y("收货方式：")])),_:1}),h(S,{modelValue:T(f),"onUpdate:modelValue":p[0]||(p[0]=e=>C(f)?f.value=e:f=e),onChange:e.takeTypeChange,localdata:T(s)},null,8,["modelValue","onChange","localdata"])])),_:1}),0==T(f)?(o(),r(P,{key:0,class:"confirm-item address",onClick:e.showStationPopup},{default:n((()=>[T(z)&&T(z).gid?(o(),r(P,{key:0,class:"address-info"},{default:n((()=>[y(F(T(z).title)+" ",1),h(L,null,{default:n((()=>[y(F("\n"))])),_:1}),y(" "+F(T(z).province?T(z).province+", ":"")+F(T(z).city?e.item.city+", ":"")+" "+F(T(z).district?T(z).district+", ":"")+" "+F(T(z).street?T(z).street+", ":"")+" "+F(T(z).detail)+" ",1),h(L,null,{default:n((()=>[y(F("\n"))])),_:1}),y(" "+F(T(z).link_name)+" "+F(T(z).link_phone),1)])),_:1})):(o(),r(P,{key:1,class:"address-info"},{default:n((()=>[y("请选择水站")])),_:1})),h(E,{type:"right",color:"#999999"})])),_:1},8,["onClick"])):1==T(f)?(o(),r(P,{key:1,class:"confirm-item address"},{default:n((()=>[T(B)&&T(B).gid?(o(),r(P,{key:0,class:"address-info"},{default:n((()=>[y(F(T(B).province?T(B).province+", ":"")+F(T(B).city?T(B).city+", ":"")+" "+F(T(B).district?T(B).district+", ":"")+" "+F(T(B).street?T(B).street+", ":"")+" "+F(T(B).detail)+" ",1),h(L,null,{default:n((()=>[y(F("\n"))])),_:1}),y(" "+F(T(B).link_name)+"，"+F(T(B).link_phone),1)])),_:1})):(o(),r(P,{key:1,class:"address-info"},{default:n((()=>[y("请选择收货地址")])),_:1})),h(E,{type:"right",color:"#999999"})])),_:1})):m("",!0)],64)):l.value.sn?(o(),u(d,{key:1},[h(P,{class:"take-type v-mb-20"},{default:n((()=>[h(P,{class:"v-mr-20"},{default:n((()=>[y("收货方式："),h(L,{class:"color-desc"},{default:n((()=>[y(F(l.value.take_type_txt),1)])),_:1})])),_:1})])),_:1}),T(z)&&T(z).gid?(o(),r(P,{key:0,class:"confirm-item address"},{default:n((()=>[h(P,{class:"address-info"},{default:n((()=>[y(F(T(z).title)+" ",1),h(L,null,{default:n((()=>[y(F("\n"))])),_:1}),y(" "+F(T(z).province?T(z).province+", ":"")+F(T(z).city?e.item.city+", ":"")+" ",1),h(L,{class:"color-green"},{default:n((()=>[y(F(T(z).district?T(z).district+", ":""),1)])),_:1}),y(" "+F(T(z).street?T(z).street+", ":"")+" "+F(T(z).detail)+" ",1),h(L,null,{default:n((()=>[y(F("\n"))])),_:1}),y(" "+F(T(z).link_name)+" "+F(T(z).link_phone),1)])),_:1})])),_:1})):T(B)&&T(B).gid?(o(),r(P,{key:1,class:"confirm-item address"},{default:n((()=>[h(P,{class:"address-info"},{default:n((()=>[y(F(T(B).province?T(B).province+", ":"")+F(T(B).city?T(B).city+", ":"")+" ",1),h(L,{class:"color-green"},{default:n((()=>[y(F(T(B).district?T(B).district+", ":""),1)])),_:1}),y(" "+F(T(B).street?T(B).street+", ":"")+" "+F(T(B).detail)+" ",1),h(L,null,{default:n((()=>[y(F("\n"))])),_:1}),y(" "+F(T(B).link_name)+"，"+F(T(B).link_phone),1)])),_:1})])),_:1})):m("",!0)],64)):m("",!0),h(P,{class:"address-bottom-line"}),h(P,{class:"confirm-item order-items"},{default:n((()=>[l.value.sn?(o(),r(P,{key:0,class:"order-sn"},{default:n((()=>[y(" 编号: "),h(L,{class:"value"},{default:n((()=>[y(F(l.value.sn),1)])),_:1}),h(L,{class:"copy-sn",onClick:J},{default:n((()=>[y("点击复制")])),_:1})])),_:1})):m("",!0),(o(!0),u(d,null,c(l.value.subs,((e,t)=>(o(),r(H,{key:e.gid,item:e},null,8,["item"])))),128))])),_:1}),h(P,{class:"confirm-item order-infos"},{default:n((()=>[h(q,{title:"商品金额",value:"￥"+(l.value.goods_amount||"0.00")},null,8,["value"]),h(q,{title:"优惠金额",value:"-￥"+(l.value.discount_amount||"0.00"),color:"#da4754",bold:""},null,8,["value"]),h(q,{title:"商品实付金额",value:"￥"+(l.value.real_amount||"0.00"),bold:""},null,8,["value"]),h(q,{title:"服务费",title2:i.value,title2color:"#da4754",value:"￥"+(l.value.deliver_amount||"0.00")},null,8,["title2","value"]),0==l.value.status?(o(),r(q,{key:0,title:"支付方式",value:T(N)[T(R)],type:"pay_type",color:"#999",onAction:e.showPayTypePopup},null,8,["value","onAction"])):(o(),r(q,{key:1,title:"支付方式",value:T(N)[T(R)],type:"pay_type",color:"#999",showRightIcon:!1},null,8,["value"])),t.value?(o(),r(q,{key:2,title:"优惠券",value:j.value.title||"选择优惠券",type:"coupon",color:"#999",onAction:e.showCouponPopup},null,8,["value","onAction"])):l.value.sn?(o(),r(q,{key:3,title:"优惠券",value:j.value&&j.value.title||"未使用",color:"#999"},null,8,["value"])):m("",!0)])),_:1}),T(g)?(o(),r(P,{key:2,class:"confirm-item"},{default:n((()=>[h(P,{class:"v-p-20 v-b-r-10"},{default:n((()=>[h(L,{class:"v-bold"},{default:n((()=>[y("订单备注：")])),_:1}),y(F(T(g)),1)])),_:1})])),_:1})):m("",!0),l.value.deliver_remark?(o(),r(P,{key:3,class:"confirm-item"},{default:n((()=>[h(P,{class:"v-p-20 v-b-r-10"},{default:n((()=>[h(L,{class:"v-bold"},{default:n((()=>[y("配送说明：")])),_:1}),y(F(l.value.deliver_remark),1)])),_:1})])),_:1})):m("",!0),l.value.deliver_images?(o(),r(P,{key:4,class:"confirm-item"},{default:n((()=>[h(P,{class:"v-p-20 v-b-r-10"},{default:n((()=>[h(P,{class:"v-mb-10 v-bold"},{default:n((()=>[y("配送照片：")])),_:1}),h(P,{class:"deliver-images"},{default:n((()=>[(o(!0),u(d,null,c(l.value.deliver_images,((e,t)=>(o(),r(W,{class:"deliver-image",onClick:e=>function(e){a({current:e,urls:l.value.deliver_images})}(t),src:e,key:t,mode:"widthFix"},null,8,["onClick","src"])))),128))])),_:1})])),_:1})])),_:1})):m("",!0),h(P,{style:{width:"100rpx",height:"120rpx"}}),l.value.sn&&1==l.value.take_type&&1==l.value.status&&1==l.value.deliver_status?(o(),r(X,{key:5,money:l.value.pay_amount||"",number:l.value.goods_total,action:"deliver",onDeliver:x},null,8,["money","number"])):(o(),r(X,{key:6,money:l.value.pay_amount||"",number:l.value.goods_total,action:"navto",onNavto:G},null,8,["money","number"])),h(Y,{ref_key:"deliverImagesRef",ref:b,sn:l.value.sn,images:k.value,onSuccess:$},null,8,["sn","images"])])),_:1})}}},[["__scopeId","data-v-403a24f7"]]);export{ee as default};

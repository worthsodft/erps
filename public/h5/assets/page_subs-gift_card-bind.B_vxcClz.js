import{j as a,e,c as l,w as t,g as u,o as n,b as o,f as i,t as s,a as d,F as c,r,l as v,h as f,i as p,d as _,z as m,S as h}from"./index-C-ZICx1j.js";import{_ as y}from"./v-line-title.DLusfvgV.js";import{r as g}from"./uni-app.es.Cs0vIm-F.js";import{_ as k}from"./uni-easyinput.YIdoTnnF.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.BrqcvC_M.js";const C=b({__name:"bind",setup(b){const C=a({});a();const $=a([]),x=a(),V=a({sn:"",code:"",vcode:"",vuniqid:""}),G=a([]);function j(){uni.$http.post("v1/captcha",{type:"GiftCardBindCaptcha"}).then((a=>{C.value=a.data,V.value.vuniqid=a.data.uniqid}))}function B(){return V.value.sn?V.value.code?V.value.vcode?!!V.value.vuniqid||uni.$tool.tip("请输入验证码标识"):uni.$tool.tip("请输入验证码"):uni.$tool.tip("请输入密码"):uni.$tool.tip("请扫描或输入卡号")}function I(){B()&&w()}j(),uni.$http.get("v1/getInitDataGiftCardBind").then((a=>{$.value=a.data.banners,G.value=a.data.remarks}));let w=uni.$tool.debounce((()=>{V.value.type="GiftCardBindCaptcha",uni.$http.post("v1/searchGiftCardForMiniBind",V.value).then((a=>{j(),V.value.vcode="",1==a.code&&(x.value=a.data.card,uni.$tool.alert("卡有效，请核对信息无误后，点击“确认绑定”按钮，进行绑卡操作"))})).catch((a=>{j()}))}));function F(){B()&&q()}let q=uni.$tool.debounce((()=>{V.value.type="GiftCardBindCaptcha",uni.$http.post("v1/bindGiftCardForMiniBind",V.value).then((a=>{j(),1==a.code&&uni.$tool.tip(a.info||"操作成功"),V.value.sn="",V.value.code="",V.value.vcode="",x.value=""})).catch((a=>{j()}))}));function U(){V.value.sn="549120919923068928"}function M(){V.value.code="8XMUWXDG53PKTG2Q"}function D(){uni.$tool.navto("/page_subs/gift_card/list")}function T(){uni.$tool.navto("/page_subs/gift_card/logs")}return(a,b)=>{const B=f,w=u,q=p,X=h,z=_,E=g(e("v-line-title"),y),J=g(e("uni-easyinput"),k),K=m;return n(),l(w,{class:"container-v main"},{default:t((()=>[o(w,{class:"banner"},{default:t((()=>[x.value?(n(),l(w,{key:0,class:"card-info"},{default:t((()=>[o(w,null,{default:t((()=>[i("卡号："),o(B,null,{default:t((()=>[i(s(x.value.sn),1)])),_:1})])),_:1}),o(w,null,{default:t((()=>[i("绑定有效期："),o(B,null,{default:t((()=>[i(s(x.value.bind_expire_at),1)])),_:1})])),_:1}),o(w,null,{default:t((()=>[i("使用有效期："),o(B,null,{default:t((()=>[i(s(x.value.useful_days)+"天（自绑定之日起）",1)])),_:1})])),_:1}),0==x.value.use_type?(n(),l(w,{key:0},{default:t((()=>[i("剩余金额："),o(B,null,{default:t((()=>[i("￥"+s(x.value.has)+" 元",1)])),_:1})])),_:1})):(n(),d(c,{key:1},[o(w,null,{default:t((()=>[i("计次商品："),o(B,null,{default:t((()=>[i(s(x.value.take_goods_sn_txt),1)])),_:1})])),_:1}),o(w,null,{default:t((()=>[i("剩余次数："),o(B,null,{default:t((()=>[i(s(x.value.has)+" 次",1)])),_:1})])),_:1})],64))])),_:1})):(n(),l(z,{key:1,class:"card-swiper","indicator-dots":"",autoplay:"",circular:"","indicator-active-color":"#25639C"},{default:t((()=>[(n(!0),d(c,null,r($.value,((a,e)=>(n(),l(X,{key:e},{default:t((()=>[o(q,{src:a,mode:"scaleToFill"},null,8,["src"])])),_:2},1024)))),128))])),_:1}))])),_:1}),o(w,{class:"container-h v-mb-20"},{default:t((()=>[o(E,{title:"卡号："})])),_:1}),o(w,{class:"container-h v-mb-20"},{default:t((()=>[o(J,{modelValue:V.value.sn,"onUpdate:modelValue":b[0]||(b[0]=a=>V.value.sn=a),suffixIcon:"scan",trim:"",onIconClick:U,placeholder:"请扫描或输入卡号"},null,8,["modelValue"])])),_:1}),o(w,{class:"container-h v-mb-20"},{default:t((()=>[o(E,{title:"密码："})])),_:1}),o(w,{class:"container-h v-mb-20"},{default:t((()=>[o(J,{modelValue:V.value.code,"onUpdate:modelValue":b[1]||(b[1]=a=>V.value.code=a),suffixIcon:"scan",trim:"",onIconClick:M,placeholder:"请输入密码"},null,8,["modelValue"])])),_:1}),o(w,{class:"container-h v-mb-20"},{default:t((()=>[o(E,{title:"验证码："})])),_:1}),o(w,{class:"container-h v-mb-20"},{default:t((()=>[o(J,{modelValue:V.value.vcode,"onUpdate:modelValue":b[2]||(b[2]=a=>V.value.vcode=a),trim:"",placeholder:"请输入验证码"},null,8,["modelValue"]),o(w,{class:"captcha",onClick:j,style:{"margin-left":"10rpx",width:"180rpx",height:"80rpx"}},{default:t((()=>[o(q,{src:C.value.image||"",mode:"widthFix",style:{width:"100%",height:"auto"}},null,8,["src"])])),_:1})])),_:1}),o(w,{class:"v-mt-50 v-text-right"},{default:t((()=>[x.value?(n(),l(K,{key:0,onClick:F,type:"primary",style:{"background-color":"#5aa1d8",color:"#fff"}},{default:t((()=>[i("确认绑定")])),_:1})):(n(),l(K,{key:1,onClick:I,type:"primary",style:{"background-color":"#f5f5f5",color:"#282828"}},{default:t((()=>[i("查 询")])),_:1})),o(w,{class:"color-green v-mt-10"},{default:t((()=>[o(B,{class:"v-mr-40",onClick:T},{default:t((()=>[i("卡使用记录")])),_:1}),o(B,{onClick:D},{default:t((()=>[i("我的实物卡")])),_:1})])),_:1})])),_:1}),G.value.length>0?(n(),d(c,{key:0},[o(E,{title:"使用说明"}),o(w,{class:"v-mt-20"},{default:t((()=>[(n(!0),d(c,null,r(G.value,((a,e)=>(n(),l(w,{class:"v-ml-20 color-desc",style:{"margin-bottom":"10rpx"},key:e},{default:t((()=>[i(s(e+1)+". "+s(a),1)])),_:2},1024)))),128))])),_:1})],64)):v("",!0)])),_:1})}}},[["__scopeId","data-v-25ca5023"]]);export{C as default};

import{_ as e}from"./uni-icons.JjreYIGb.js";import{j as t,e as a,o as l,c as i,w as n,b as s,f as o,t as c,n as u,g as d,i as r,h as m,a as f,v as _,F as p,r as v,l as k}from"./index-Bk6Bf557.js";import{r as h,o as b}from"./uni-app.es.VV1Xt59_.js";import{_ as g}from"./v-number-box.Deoy8nl_.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as y}from"./uni-load-more.ZwF_zjD4.js";const C=x({__name:"v-cart-item2",props:{item:Object,index:[String,Number]},emits:["delItem","numbeChange","check"],setup(f,{emit:_}){t("");const p=f,v=_,k=()=>{v("check",{index:p.index,is_checked:!p.item.is_checked})};function b(e){v("numbeChange",{index:p.index,number:e})}function x(){v("delItem",p.index)}function y(){uni.$tool.navto("/pages/goods/detail?sn="+p.item.sn)}return(t,_)=>{const p=h(a("uni-icons"),e),v=d,C=r,$=m,j=h(a("v-number-box"),g);return l(),i(v,{class:"cart-item"},{default:n((()=>[s(v,{class:"item-check",onClick:k},{default:n((()=>[f.item.is_checked?(l(),i(p,{key:0,type:"checkbox-filled",size:"20",color:"#5aa1d8"})):(l(),i(p,{key:1,type:"checkbox",size:"20",color:"#ccc"}))])),_:1}),s(C,{class:"cover",onClick:y,src:f.item.cover,mode:"aspectFill"},null,8,["src"]),s(v,{class:"info"},{default:n((()=>[s(v,{class:"title v-ellip",onClick:y},{default:n((()=>[o(c(f.item.name),1)])),_:1}),s(v,{class:"info-item"},{default:n((()=>[s($,{class:"v-tag"},{default:n((()=>[o(c(f.item.min_buy_number)+c(f.item.unit)+"起送",1)])),_:1}),s($,{class:"v-tag v-ml-10"},{default:n((()=>[o("运费"+c(parseFloat(f.item.deliver_fee))+"元/"+c(f.item.unit),1)])),_:1})])),_:1}),s(v,{class:"info-item"},{default:n((()=>[s($,{class:"item-value price"},{default:n((()=>[o("￥"+c(f.item.self_price),1)])),_:1}),o(),s($,{class:"item-value"},{default:n((()=>[o("/ "+c(f.item.unit),1)])),_:1})])),_:1}),s(v,{class:"operate"},{default:n((()=>[s(v,{class:"total"},{default:n((()=>[o(" 小计: "),s($,null,{default:n((()=>[o("￥"+c(f.item.amount),1)])),_:1})])),_:1}),s(v,{onClick:_[1]||(_[1]=u((()=>{}),["stop"]))},{default:n((()=>[s(j,{modelValue:f.item.number,"onUpdate:modelValue":_[0]||(_[0]=e=>f.item.number=e),onChange:b,min:1,max:f.item.stock,width:30,background:"#5aa1d830",color:"#8A8A8A"},null,8,["modelValue","max"])])),_:1})])),_:1})])),_:1}),s(v,{class:"del-item",onClick:u(x,["stop"])},{default:n((()=>[s($,{class:"cart-del"},{default:n((()=>[o("删除")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-9083345d"]]),$=x({__name:"cart",setup(r){const g=t({}),x=t(uni.$tool.getTabBarHeight()+"rpx");uni.$login.judgeLogin((()=>{uni.$api.getCartTotal()})),b((()=>{uni.$http.get("v1/getInitDataCart").then((e=>{g.value=e.data.cart,uni.$tool.setCartBadge(g.value.total)}))}));const $=e=>{I(e)},j=()=>{let e={index:-1,is_checked:!g.value.is_checked};I(e)},I=e=>{let t={sn:-1==e.index?-1:g.value.list[e.index].sn,is_checked:e.is_checked};uni.$api.check2cart(t,(e=>{g.value=e.data.cart}))};function z(e){let t=g.value.list;t[e.index];let a={sn:t[e.index].sn,number:e.number};uni.$api.update2cart(a,(e=>{g.value=e.data.cart}))}function A(e){uni.$tool.confirm("确认要从购物车删除此项吗？",(()=>{let t=g.value.list;t[e],function(e){uni.$api.del2cart(e,(e=>{g.value=e.data.cart}))}({sn:t[e].sn})}))}function F(){if(0==g.value.total)return uni.$tool.tip("商品列表不能为空");uni.$login.judgePhone((()=>{uni.$tool.navto("/pages/order/confirm?from=cart")}))}return(t,r)=>{const b=h(a("v-cart-item2"),C),I=h(a("uni-load-more"),y),V=d,w=h(a("uni-icons"),e),B=m;return l(),f(p,null,[s(V,{class:"container-v cart"},{default:n((()=>[(l(!0),f(p,null,v(g.value.list,((e,t)=>(l(),i(b,{key:e.id,item:e,index:t,onDelItem:A,onNumbeChange:z,onCheck:$},null,8,["item","index"])))),128)),g.value.list&&g.value.list.length<1?(l(),i(I,{key:0,status:"nomore"})):k("",!0)])),_:1}),s(V,{class:"total-info",style:_({bottom:x.value})},{default:n((()=>[s(V,{style:{display:"flex","align-items":"center"}},{default:n((()=>[s(V,{class:"item-check",onClick:j},{default:n((()=>[g.value.is_checked?(l(),i(w,{key:0,type:"checkbox-filled",size:"20",color:"#5aa1d8"})):(l(),i(w,{key:1,type:"checkbox",size:"20",color:"#ccc"})),o(" 全选 ")])),_:1}),s(V,{class:"item"},{default:n((()=>[o("合计："),s(B,{class:"total-price"},{default:n((()=>[o("￥"+c(g.value.amount||"0.00"),1)])),_:1})])),_:1})])),_:1}),s(V,{class:"v-button btn-green",onClick:u(F,["stop"])},{default:n((()=>[o("去结算("+c(g.value.total||0)+")",1)])),_:1})])),_:1},8,["style"])],64)}}},[["__scopeId","data-v-d051be55"]]);export{$ as default};
